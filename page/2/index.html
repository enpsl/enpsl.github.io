<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"enpsl.github.io",root:"/",scheme:"Muse",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="my blog"><meta property="og:type" content="website"><meta property="og:title" content="å½­è¯—äº®çš„åšå®¢"><meta property="og:url" content="https://enpsl.github.io/page/2/index.html"><meta property="og:site_name" content="å½­è¯—äº®çš„åšå®¢"><meta property="og:description" content="my blog"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="enpsl"><meta property="article:tag" content="å½­è¯—äº® psl pengshiliang blog"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://enpsl.github.io/page/2/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!0,isPost:!1,lang:"zh-CN"}</script><title>å½­è¯—äº®çš„åšå®¢</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">å½­è¯—äº®çš„åšå®¢</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> å½’æ¡£</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content index posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2022/01/18/%E8%AE%B0%E4%B8%80%E6%AC%A1golang%20slice%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2022/01/18/%E8%AE%B0%E4%B8%80%E6%AC%A1golang%20slice%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">golang slice é—®é¢˜æ’æŸ¥</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-18 19:30:00" itemprop="dateCreated datePublished" datetime="2022-01-18T19:30:00+08:00">2022-01-18</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><h3 id="å‰ç½®çŸ¥è¯†ç‚¹"><a href="#å‰ç½®çŸ¥è¯†ç‚¹" class="headerlink" title="å‰ç½®çŸ¥è¯†ç‚¹"></a>å‰ç½®çŸ¥è¯†ç‚¹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</span><br><span class="line">    <span class="keyword">var</span> a = []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line">    b := a</span><br><span class="line">    b[<span class="number">1</span>] = <span class="number">3</span></span><br><span class="line">    fmt.Println(a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1 3]</span><br></pre></td></tr></table></figure><p>å…ˆä¸Šä¸€æ®µç®€å•ä»£ç ,ä¿®æ”¹b[1]çš„å€¼å‘ç°a[1]çš„å€¼ä¹Ÿè·Ÿç€å˜åŒ–ï¼ŒåŸå› æ˜¯aå’Œbé‡Œæˆå‘˜çš„åœ°å€æ˜¯æŒ‡å‘åŒä¸€å¤„çš„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>&#125;</span><br><span class="line">b := a</span><br><span class="line">b[<span class="number">1</span>] = <span class="number">3</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;a[0]åœ°å€:%p\n&quot;</span>, &amp;a[<span class="number">0</span>])</span><br><span class="line">fmt.Printf(<span class="string">&quot;a[1]åœ°å€:%p\n&quot;</span>, &amp;a[<span class="number">1</span>])</span><br><span class="line">fmt.Printf(<span class="string">&quot;b[0]åœ°å€:%p\n&quot;</span>, &amp;b[<span class="number">0</span>])</span><br><span class="line">fmt.Printf(<span class="string">&quot;b[1]åœ°å€:%p\n&quot;</span>, &amp;b[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a[0]åœ°å€:0xc0000b2010</span><br><span class="line">a[1]åœ°å€:0xc0000b2018</span><br><span class="line">b[0]åœ°å€:0xc0000b2010</span><br><span class="line">b[1]åœ°å€:0xc0000b2018</span><br></pre></td></tr></table></figure><h3 id="è¸©å‘èƒŒæ™¯"><a href="#è¸©å‘èƒŒæ™¯" class="headerlink" title="è¸©å‘èƒŒæ™¯"></a>è¸©å‘èƒŒæ™¯</h3><p>è¸©å‘ç»å†æ˜¯å‘ç”Ÿåœ¨åˆ·åŠ›æ‰£é¢˜<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/combination-sum/description/">ç»„åˆæ€»å’Œ</a>è¿™é“é¢˜çš„æ—¶å€™ï¼Œæäº¤åå‘ç°ä¸€ä¸ªcaseæ²¡é€šè¿‡<br><img src="/img/in-post/2022-01-15/img_1.png" alt="img_1.png"><br>æ€è€ƒğŸ¤”äº†å‡ éï¼Œæ²¡å‘ç°å‡ºä»£ç é€»è¾‘ä¸Šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œç™¾æ€ä¸å¾—å…¶è§£æƒ…å†µä¸‹åœ¨æœ¬åœ°è¿è¡Œäº†ä¸‹è¯¥caseï¼Œå‘ç°å‡ºç°äº†åŒæ ·çš„æƒ…å†µğŸ˜–<br>ä¸‹é¢æ˜¯å½“æ—¶åˆ·é¢˜æäº¤çš„ä»£ç :(ä¸ºäº†æ–¹ä¾¿é—®é¢˜åˆ†æï¼Œç”±äºåŠ›æ‰£åŸé¢˜è¾“å‡ºé¡¹æ¯”è¾ƒå¤šï¼Œå› æ­¤å¯¹è¯¥caseç®€åŒ–äº†ä¸€ä¸‹)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	res1 := CombinationSum1([]<span class="type">int</span>&#123;<span class="number">7</span>,<span class="number">3</span>,<span class="number">2</span>&#125;, <span class="number">12</span>)</span><br><span class="line">	fmt.Println(res1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CombinationSum1</span><span class="params">(candidates []<span class="type">int</span>, target <span class="type">int</span>)</span></span> [][]<span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="built_in">make</span>([][]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span><span class="params">([]<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, []<span class="type">int</span>, <span class="type">int</span>)</span></span></span><br><span class="line">    backtrack = <span class="function"><span class="keyword">func</span><span class="params">(candidate[]<span class="type">int</span>, begin, size <span class="type">int</span>, ints []<span class="type">int</span>, val <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> val &lt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> val == <span class="number">0</span> &#123;</span><br><span class="line">            res = <span class="built_in">append</span>(res, ints)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> i := begin; i &lt; size; i++ &#123;</span><br><span class="line">            backtrack(candidate, i, size, <span class="built_in">append</span>(ints, candidate[i]), val - candidate[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    backtrack(candidates, <span class="number">0</span>, <span class="built_in">len</span>(candidates), []<span class="type">int</span>&#123;&#125;, target)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¾“å‡º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[7 3 2] [3 3 3 2] [3 3 2 2 2] [2 2 2 2 2 2]]</span><br></pre></td></tr></table></figure><blockquote><p>å¾ˆæ˜æ˜¾[3 3 3 2]åŠ èµ·æ¥ä¸æ˜¯12ï¼Œå’Œleetcodeå‡ºç°çš„é—®é¢˜æ˜¯ä¸€æ ·çš„</p></blockquote><h3 id="è¸©å‘åŸå› åˆ†æ"><a href="#è¸©å‘åŸå› åˆ†æ" class="headerlink" title="è¸©å‘åŸå› åˆ†æ"></a>è¸©å‘åŸå› åˆ†æ</h3><p>ä¸€å¼€å§‹ï¼Œå…ˆæ˜¯åœ¨appendå¤„æ‰“å°ä¸‹<code>ints</code>å˜é‡å†…å®¹ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è·¯å¾„å’Œè®¡ç®—æœ‰é—®é¢˜</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> val == <span class="number">0</span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;append ints %v\n&quot;</span>, ints)</span><br><span class="line">    res = <span class="built_in">append</span>(res, ints)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">append ints [7 3 2]</span><br><span class="line">append ints [3 3 3 3]</span><br><span class="line">append ints [3 3 2 2 2]</span><br><span class="line">append ints [2 2 2 2 2 2]</span><br><span class="line">[[7 3 2] [3 3 3 2] [3 3 2 2 2] [2 2 2 2 2 2]]</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œå‘ç°äº†äº‹æƒ…çš„ä¸å¦™ï¼Œappend<code>ints</code>æ—¶<code>ints</code>çš„æˆå‘˜æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æœ€ç»ˆè¾“å‡º<code>ints</code>çš„æˆå‘˜ç¡®ç”±<code>[3 3 3 3]</code>å˜ä¸ºäº†<code>[3 3 3 2]</code>,<br>äºæ˜¯çŒœæµ‹ä¸€å®šå‡½æ•°<code>backtrack(...append(ints, candidate[i])...)</code>è¿™ä¸ªå‡½æ•°è°ƒç”¨æ—¶<code>ints[3]</code>æˆå‘˜çš„åœ°å€çš„å€¼åœ¨åé¢è¢«ä¿®æ”¹äº†ï¼Œå› ä¸ºé€šè¿‡å…ˆå‰çš„ä¸¾ä¾‹æˆ‘ä»¬ä¹ŸçŸ¥é“äº†<code>slice</code>é‡Œçš„æˆå‘˜æ˜¯å¼•ç”¨çš„å—ğŸ”<br>æ‰€ä»¥å†³å®šæ–­ç‚¹æ‰“å°ä¸€ä¸‹æ¥å°è¯è‡ªå·±çš„çŒœæƒ³ï¼Œç”±äºæ–­ç‚¹è¿‡ç¨‹ä¸­éœ€è¦æ¯æ¬¡æŸ¥çœ‹æ ˆç©ºé—´å‡½æ•°å„ä¸ªå‚æ•°çš„å€¼å·²ç»å‡½æ•°é€’å½’è°ƒç”¨æ˜¯<code>ints</code>æˆå‘˜çš„åœ°å€å€¼çš„å˜åŒ–ï¼Œæ‰€ä»¥é‡‡ç”¨<code>gdb</code>å·¥å…·è¿›è¡Œæ–­ç‚¹</p><h3 id="æ–­ç‚¹è¿½è¸ª"><a href="#æ–­ç‚¹è¿½è¸ª" class="headerlink" title="æ–­ç‚¹è¿½è¸ª"></a>æ–­ç‚¹è¿½è¸ª</h3><p>é€šè¿‡ä¸Šé¢çš„è¾“å‡ºç»“æœæˆ‘ä»¬çŸ¥é“<code>ints</code>æ˜¯åœ¨ç¬¬äºŒæ¬¡appendåè¾“å‡ºçš„ï¼Œæ‰€ä»¥ç›´æ¥ä»ç¬¬äºŒæ¬¡appendåå¼€å§‹åˆ†æ,å¹¶ä¸”<code>ints[3]</code>å‘ç”Ÿäº†éé¢„æœŸç»“æœï¼Œæ‰€ä»¥åªåˆ†æ<code>ints[3]</code>çš„åœ°å€å’Œå€¼å³å¯</p><h4 id="è¿½è¸ªstep1"><a href="#è¿½è¸ªstep1" class="headerlink" title="è¿½è¸ªstep1"></a>è¿½è¸ªstep1</h4><p>é¦–å…ˆï¼Œå› ä¸ºå‘ç°é—®é¢˜åˆ†æ­§çš„åŸå› æ˜¯åœ¨<code>res = append(res, ints)</code>è¿™è¡Œäº§ç”Ÿçš„ï¼Œå› æ­¤åœ¨è¿™é‡Œbreakä¸€ä¸‹(å¦‚ä¸‹å›¾æ‰€ç¤º)<br><img src="/img/in-post/2022-01-15/img_11.png" alt="img_11.png"></p><h4 id="è¿½è¸ªstep2"><a href="#è¿½è¸ªstep2" class="headerlink" title="è¿½è¸ªstep2"></a>è¿½è¸ªstep2</h4><p>çœ‹ä¸€ä¸‹å½“å‰<code>æ ˆ</code>ç©ºé—´å˜é‡æˆå‘˜(å¦‚ä¸‹å›¾æ‰€ç¤º)<br><img src="/img/in-post/2022-01-15/img_12.png" alt="img_12.png"></p><blockquote><p>è¿™æ—¶ï¼Œ<code>ints[3]</code>è¿˜æ˜¯æ­£å¸¸çš„ï¼Œæ‰“å°ç»“æœæ˜¯<code>3</code>,æˆ‘ä»¬è®°å½•ä¸‹å½“å‰<code>ints[3]</code>çš„åœ°å€<code>0xc0000ae078</code>,intså˜é‡çš„åœ°å€<code>0xc0000ae060</code>ä¹Ÿè®°å½•ä¸‹ï¼Œåé¢ä¼šç”¨åˆ°</p></blockquote><h4 id="è¿½è¸ªstep3"><a href="#è¿½è¸ªstep3" class="headerlink" title="è¿½è¸ªstep3"></a>è¿½è¸ªstep3</h4><p>å½“<code>beign=1;i=1</code>æ—¶(å¦‚ä¸‹å›¾æ‰€ç¤º)ï¼›<code>candidate[i]</code>ä¼šè¢«appendåˆ°intsä¸­ï¼Œçœ‹ä¸‹<code>candidate[i] = 3</code>ï¼Œè¿™æ—¶å³ä½¿<code>ints[3]</code>åœ°å€è¢«é‡æ–°èµ‹å€¼ä¸º<code>candidate[i]</code>ï¼Œä¹Ÿè¿˜æ˜¯ä¼šä¸º3ï¼Œçœ‹ä¸å‡ºæ¥ä»€ä¹ˆå˜åŒ–ï¼Œç»§ç»­èµ°<br><img src="/img/in-post/2022-01-15/img_13.png" alt="img_13.png"></p><h4 id="è¿½è¸ªstep4"><a href="#è¿½è¸ªstep4" class="headerlink" title="è¿½è¸ªstep4"></a>è¿½è¸ªstep4</h4><p>æˆ‘ä»¬ç›´æ¥è·³åˆ°i&#x3D;2;begin&#x3D;1(å¦‚ä¸‹å›¾æ‰€ç¤º)ï¼›æ­¤æ—¶å‘ç°ä¸‹é¢çš„i&#x3D;1ï¼Œè¯æ˜å‡½æ•°è¿˜æ²¡å¼€å§‹è°ƒç”¨ï¼Œç»§ç»­<br><img src="/img/in-post/2022-01-15/img_14.png" alt="img_14.png"></p><blockquote><p>ä¸ºä»€ä¹ˆåœ¨i&#x3D;2åé¢iåˆå˜ä¸ºäº†1ï¼Œå¹¶ä¸”è¿˜æœ‰backtrackå‡½æ•°è°ƒç”¨ï¼Ÿ<br>è§£é‡Šï¼šå› ä¸ºåœ¨å›æº¯é€’å½’åœºæ™¯ä¸­ï¼Œå½“å‰å¾ªç¯é‡Œï¼Œå‡½æ•°å¯èƒ½è¿˜å­˜åœ¨å…¶ä»–å¾ªç¯æ—¶é€’å½’è°ƒç”¨çš„å‡½æ•°ï¼Œè€Œåœ¨å…¶ä»–å¾ªç¯é‡Œé€’å½’è°ƒç”¨çš„å‡½æ•°æˆå‘˜å†…å­˜åœ°å€æ˜¯è·Ÿå½“å‰å¾ªç¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¸åšè¿½è¸ª</p></blockquote><h4 id="è¿½è¸ªstep5"><a href="#è¿½è¸ªstep5" class="headerlink" title="è¿½è¸ªstep5"></a>è¿½è¸ªstep5</h4><p>æ‰“å°<code>candidate[2]</code>ï¼Œå‘ç°å€¼ä¸º2(å¦‚ä¸‹å›¾æ‰€ç¤º),å› ä¸ºè¿™æ—¶å‡½æ•°è¿˜æœªè°ƒç”¨ï¼Œ<code>candidate[2]</code>è¿˜æœªappendï¼Œå‡½æ•°å°†ä¼šåœ¨ä¸‹ä¸€è¡Œè°ƒç”¨ï¼Œæ‰€ä»¥<code>ints[3]</code>è¿˜æ˜¯3ç»§ç»­è¿½è¸ª<br><img src="/img/in-post/2022-01-15/img_15.png" alt="img_15.png"></p><h4 id="è¿½è¸ªstep6"><a href="#è¿½è¸ªstep6" class="headerlink" title="è¿½è¸ªstep6"></a>è¿½è¸ªstep6</h4><p>å½“backtrackå‡½æ•°æ‰§è¡Œå;<code>candidate[2]</code>è¢«appendåˆ°äº†<code>ints</code>ä¸­ï¼Œæ­¤æ—¶<code>ints[3]</code>çš„åœ°å€çš„å€¼å‘ç”Ÿäº†ä¿®æ”¹(å¦‚ä¸‹å›¾æ‰€ç¤º),æ‰€ä»¥<code>res</code>æœ€åè¿”å›ç»“æœçš„åˆ‡ç‰‡ä¹Ÿå‘ç”Ÿäº†ä¿®æ”¹<br><img src="/img/in-post/2022-01-15/img_16.png" alt="img_16.png"><br>æ­¤æ—¶<code>ints[]3</code>çš„åœ°å€<code>0xc0000ae078</code>è¿˜æ˜¯ä¹‹å‰çš„åœ°å€ï¼Œè¯å®äº†æˆ‘ä»¬çš„çŒœæƒ³</p><h4 id="è¿½è¸ªstep7"><a href="#è¿½è¸ªstep7" class="headerlink" title="è¿½è¸ªstep7"></a>è¿½è¸ªstep7</h4><p>æ¥ç€å¾€ä¸‹èµ°ï¼Œå› ä¸ºi&#x3D;2åï¼Œåœ¨++ä¸º3åä¸æ»¡è¶³<code>i&lt;size</code>åˆ¤æ–­ï¼Œæ‰€ä»¥é€€å‡ºå½“å‰å¾ªç¯ï¼Œè¿›å…¥åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯çš„å‡½æ•°æ ˆ<br><img src="/img/in-post/2022-01-15/img_17.png" alt="img_17.png"><br>æ­¤æ—¶ints[3]åœ°å€ç”±<code>0xc0000ae078</code>å˜ä¸ºäº†<code>0xc0000ac058</code>ï¼Œintsåœ°å€ç”±<code>0xc0000ae060</code>å˜ä¸ºäº†<code>0xc0000ac040</code></p><blockquote><p>ä¹‹å‰çš„intsåœ°å€å’Œintsåœ°å€åœ¨è¿½è¸ªstep2è®°å½•è¿‡</p></blockquote><h4 id="åˆæ­¥ç»“è®º"><a href="#åˆæ­¥ç»“è®º" class="headerlink" title="åˆæ­¥ç»“è®º"></a>åˆæ­¥ç»“è®º</h4><p>åœ¨å½“å‰å‡½æ•°æ ˆå†…ï¼Œintsæˆå‘˜çš„åœ°å€åœ¨æ¯æ¬¡å¾ªç¯è°ƒç”¨æ—¶æ˜¯ä¸å˜çš„,æ‰€ä»¥åœ¨å½“å‰å¾ªç¯å‡½æ•°è°ƒç”¨æ—¶,intså‘ç”Ÿappendåï¼Œç”±äºæ˜¯æµ…æ‹·è´ï¼Œæ‰€ä»¥ä¼šå‘ç”Ÿè¿”å›åˆ‡ç‰‡ç»“æœæˆå‘˜æ•°æ®<code>è¢«æ±¡æŸ“</code>çš„æƒ…å†µ</p><h3 id="è¿½è¸ªç»“è®ºå°è¯"><a href="#è¿½è¸ªç»“è®ºå°è¯" class="headerlink" title="è¿½è¸ªç»“è®ºå°è¯"></a>è¿½è¸ªç»“è®ºå°è¯</h3><p>ä»å‰é¢çš„ç»“è®ºå¯çŸ¥ï¼Œç”±äº<code>candidate[2]</code>æ˜¯åœ¨å¾ªç¯æœ€åè¢«appendçš„ï¼Œæ‰€ä»¥å¯¹<code>ints[3]</code>åœ°å€æŒ‡å‘çš„å€¼å‘ç”Ÿäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è¾“å…¥é¡¹ä¸­å¢åŠ ä¸€ä¸ªå…ƒç´ ï¼Œæ¥å°è¯å½“å‰ç»“è®º</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res1 := CombinationSum1([]<span class="type">int</span>&#123;<span class="number">7</span>,<span class="number">3</span>,<span class="number">2</span>, <span class="number">8</span>&#125;, <span class="number">12</span>)</span><br></pre></td></tr></table></figure><p>æ‰“å°è¾“å‡ºç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">append ints [7 3 2]</span><br><span class="line">append ints [3 3 3 3]</span><br><span class="line">append ints [3 3 2 2 2]</span><br><span class="line">append ints [2 2 2 2 2 2]</span><br><span class="line">append ints [2 2 8]</span><br><span class="line">[[7 3 2] [3 3 3 8] [3 3 2 2 2] [2 2 2 2 2 8] [2 2 8]]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>[3 3 3 2]</code>å˜ä¸ºäº†<code>[3 3 3 8]</code></p><h3 id="How-To-Fix"><a href="#How-To-Fix" class="headerlink" title="How To Fix"></a>How To Fix</h3><p>äº†è§£é—®é¢˜æ ¹æœ¬åŸå› åæƒ³è§£å†³å°±å¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬åªè¦åœ¨appendæ—¶æ·±æ‹·è´ä¸€æ¬¡intså°±å¯ä»¥äº†<br>è§£å†³åå®Œæ•´ä»£ç :</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	res1 := CombinationSum2([]<span class="type">int</span>&#123;<span class="number">7</span>,<span class="number">3</span>,<span class="number">2</span>, <span class="number">8</span>&#125;, <span class="number">12</span>)</span><br><span class="line">	fmt.Println(res1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CombinationSum1</span><span class="params">(candidates []<span class="type">int</span>, target <span class="type">int</span>)</span></span> [][]<span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> res = <span class="built_in">make</span>([][]<span class="type">int</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span><span class="params">([]<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, []<span class="type">int</span>, <span class="type">int</span>)</span></span></span><br><span class="line">	backtrack = <span class="function"><span class="keyword">func</span><span class="params">(candidate[]<span class="type">int</span>, begin, size <span class="type">int</span>, ints []<span class="type">int</span>, val <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> val &lt; <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> val == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">var</span> tmp = <span class="built_in">make</span>([]<span class="type">int</span>, <span class="built_in">len</span>(ints))</span><br><span class="line">			<span class="built_in">copy</span>(tmp, ints)</span><br><span class="line">			fmt.Println(<span class="string">&quot;append after copied ints&quot;</span>, tmp)</span><br><span class="line">			res = <span class="built_in">append</span>(res, tmp)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> i := begin; i &lt; size; i++ &#123;</span><br><span class="line">			backtrack(candidate, i, size, <span class="built_in">append</span>(ints, candidate[i]), val - candidate[i])</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	backtrack(candidates, <span class="number">0</span>, <span class="built_in">len</span>(candidates), []<span class="type">int</span>&#123;&#125;, target)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">append</span> after copied ints [<span class="number">7</span> <span class="number">3</span> <span class="number">2</span>]</span><br><span class="line"><span class="built_in">append</span> after copied ints [<span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span>]</span><br><span class="line"><span class="built_in">append</span> after copied ints [<span class="number">3</span> <span class="number">3</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span>]</span><br><span class="line"><span class="built_in">append</span> after copied ints [<span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span>]</span><br><span class="line"><span class="built_in">append</span> after copied ints [<span class="number">2</span> <span class="number">2</span> <span class="number">8</span>]</span><br><span class="line">[[<span class="number">7</span> <span class="number">3</span> <span class="number">2</span>] [<span class="number">3</span> <span class="number">3</span> <span class="number">3</span> <span class="number">3</span>] [<span class="number">3</span> <span class="number">3</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span>] [<span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span>] [<span class="number">2</span> <span class="number">2</span> <span class="number">8</span>]]</span><br></pre></td></tr></table></figure><p>ç®—æ³•æäº¤é€šè¿‡ğŸ‘<br><img src="/img/in-post/2022-01-15/img_18.png" alt="img_18.png"></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2022/01/15/%E5%9B%9E%E6%BA%AF%E6%A8%A1%E7%89%88/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2022/01/15/%E5%9B%9E%E6%BA%AF%E6%A8%A1%E7%89%88/" class="post-title-link" itemprop="url">å›æº¯æ¨¡ç‰ˆ</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-15 19:30:00" itemprop="dateCreated datePublished" datetime="2022-01-15T19:30:00+08:00">2022-01-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 16:50:07" itemprop="dateModified" datetime="2023-01-19T16:50:07+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h4 id="å›æº¯æ¨¡ç‰ˆæ€»ç»“"><a href="#å›æº¯æ¨¡ç‰ˆæ€»ç»“" class="headerlink" title="å›æº¯æ¨¡ç‰ˆæ€»ç»“"></a>å›æº¯æ¨¡ç‰ˆæ€»ç»“</h4><p>é€‚ç”¨äºç»“æœè·¯å¾„é‡Œå…ƒç´ ä¸å¯é‡å¤ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºç©ºslice</span><br><span class="line"><span class="keyword">for</span> é€‰æ‹© in é€‰æ‹©åˆ—è¡¨:</span><br><span class="line">    # åšé€‰æ‹©</span><br><span class="line">    å°†è¯¥é€‰æ‹©ä»é€‰æ‹©åˆ—è¡¨ç§»é™¤</span><br><span class="line">    slice = slice[<span class="number">1</span>:]</span><br><span class="line">    backtrack(è·¯å¾„.<span class="built_in">append</span>, é€‰æ‹©åˆ—è¡¨)</span><br><span class="line">    # æ’¤é”€é€‰æ‹©</span><br><span class="line">	slice = slice[:<span class="built_in">len</span>(slice) - <span class="number">1</span>]</span><br><span class="line">    å°†è¯¥é€‰æ‹©å†åŠ å…¥é€‰æ‹©åˆ—è¡¨</span><br></pre></td></tr></table></figure><p>é€‚ç”¨äºç»“æœè·¯å¾„é‡Œå…ƒç´ å¯é‡å¤ä½¿ç”¨ï¼Œæ’åˆ—é¡ºåºä¸èƒ½é‡å¤</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">åˆ›å»ºç©ºslice</span><br><span class="line"><span class="keyword">for</span> é€‰æ‹© in é€‰æ‹©åˆ—è¡¨:</span><br><span class="line">    # åšé€‰æ‹©</span><br><span class="line">    å°†è¯¥é€‰æ‹©ä»é€‰æ‹©åˆ—è¡¨ç§»é™¤</span><br><span class="line">    num := slice[i]</span><br><span class="line">    slice = <span class="built_in">append</span>(slice[:i], slice[i+<span class="number">1</span>:]...)</span><br><span class="line">    backtrack(è·¯å¾„.<span class="built_in">append</span>, é€‰æ‹©åˆ—è¡¨)</span><br><span class="line">    # æ’¤é”€é€‰æ‹©</span><br><span class="line">	slice = <span class="built_in">append</span>(slice[:i], <span class="built_in">append</span>([]<span class="type">int</span>&#123;num&#125;, slice[i:]...)...)</span><br><span class="line">    å°†è¯¥é€‰æ‹©å†åŠ å…¥é€‰æ‹©åˆ—è¡¨</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2022/01/14/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2022/01/14/%E5%9B%9E%E6%BA%AF%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">å›æº¯ç®—æ³•</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2022-01-14 19:30:00" itemprop="dateCreated datePublished" datetime="2022-01-14T19:30:00+08:00">2022-01-14</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="å›æº¯ç®—æ³•"><a href="#å›æº¯ç®—æ³•" class="headerlink" title="å›æº¯ç®—æ³•"></a>å›æº¯ç®—æ³•</h2><h4 id="å›æº¯é¢˜ç›®åº”ç”¨"><a href="#å›æº¯é¢˜ç›®åº”ç”¨" class="headerlink" title="å›æº¯é¢˜ç›®åº”ç”¨"></a>å›æº¯é¢˜ç›®åº”ç”¨</h4><p>ä»¥åŠ›æ‰£<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/generate-parentheses/submissions/393569541/" title="https://leetcode.cn/problems/generate-parentheses/submissions/393569541/">https://leetcode.cn/problems/generate-parentheses/submissions/393569541/</a>ç®—æ³•ä¸ºä¾‹:</p><p>é¢˜ç›®è¦æ±‚ï¼šè¾“å…¥ä¸€ä¸ªæ•°å­—n:æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸”æœ‰æ•ˆçš„æ‹¬å·ç»„åˆ</p><h3 id="å›æº¯åˆ†æè¿‡ç¨‹"><a href="#å›æº¯åˆ†æè¿‡ç¨‹" class="headerlink" title="å›æº¯åˆ†æè¿‡ç¨‹"></a>å›æº¯åˆ†æè¿‡ç¨‹</h3><h4 id="å…ˆæšä¸¾"><a href="#å…ˆæšä¸¾" class="headerlink" title="å…ˆæšä¸¾"></a>å…ˆæšä¸¾</h4><p>æ ¹æ®é¢˜ç›®è¦æ±‚ï¼šå¯åˆ†æå¾—åˆ°è¦ç”Ÿæˆnå¯¹æ‹¬å·ï¼Œå¹¶ä¸”æ‹¬å·æ˜¯æœ‰æ•ˆæ‹¬å·ï¼Œç”±äºé¢˜ç›®è¦æ±‚åˆ—å‡ºæ‰€æœ‰ç»„åˆå¯èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°†æ‹¬å·æ‹†åˆ†æˆ<code>(</code>å’Œ<code>)</code>,è¿™æ ·æˆ‘ä»¬ä¸€å…±éœ€è¦ç”Ÿæˆ2nä¸ªè¿™æ ·çš„æ‹¬å· å…ˆå‘æŒ¥æˆ‘ä»¬çš„å¤§è„‘æƒ³è±¡ğŸ˜‡ï¼Œåˆ—ä¸¾å‡ºè¿™2nä¸ªæ‹¬å·çš„æ‰€æœ‰æ’åˆ—ç»„åˆ</p><p>å·²n&#x3D;2ä¸ºä¾‹:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">))))</span><br><span class="line">)))(</span><br><span class="line">))()</span><br><span class="line">))((</span><br><span class="line">)())</span><br><span class="line">)()(</span><br><span class="line">)(()</span><br><span class="line">)(((</span><br><span class="line">()))</span><br><span class="line">())(</span><br><span class="line">()()</span><br><span class="line">()((</span><br><span class="line">(())</span><br><span class="line">(()(</span><br><span class="line">((()</span><br><span class="line">((((</span><br></pre></td></tr></table></figure><p>å¯æšä¸¾å‡º16ç§å¯èƒ½ï¼Œä½†æ˜¯è¿™äº›ç»“æœé›†å¹¶ä¸æ˜¯æˆ‘ä»¬éƒ½éœ€è¦çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é’ˆå¯¹æœ‰æ•ˆæ‹¬å·çš„ç‰¹æ€§åšå‡ºä¸€äº›ç­›å‡ï¼›åˆ†æè‡³æ­¤ï¼Œä¼šå¾ˆè½»æ˜“å‘ç°ï¼Œè¿™æ˜¯ä¸æ˜¯å’Œ<code>å›æº¯</code>çš„æ€æƒ³å¾ˆç±»ä¼¼å‘¢?å›æº¯çš„æ ¸å¿ƒæ€æƒ³æ˜¯:åœ¨forå¾ªç¯é‡Œé¢è¿›è¡Œé€’å½’ï¼Œæšä¸¾å‡ºæ‰€æœ‰å¯èƒ½ï¼Œåœ¨é€’å½’è°ƒç”¨ä¹‹å‰ã€Œåšé€‰æ‹©ã€ï¼Œåœ¨é€’å½’è°ƒç”¨ä¹‹åã€Œæ’¤é”€é€‰æ‹©ã€ï¼›è€Œ<code>åšé€‰æ‹©</code>å°±æ˜¯å¯¹ç©·ä¸¾çš„æ’åˆ—ç»„åˆè¿›è¡Œç­›å‡ï¼Œåˆ¤æ–­å‡ºä¸åˆæ³•çš„é€‰æ‹©ï¼Œç„¶åè¿‡æ»¤æ‰ï¼Œè¿™ç§è¿‡ç¨‹é€šå¸¸è¢«å«åš<code>å‰ªæ</code>ã€‚<code>æ’¤é”€é€‰æ‹©</code>å³æ¢ç´¢è¿‡ç¨‹ä¸­å‘ç°å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›ä¸€æ­¥é‡æ–°é€‰æ‹©</p><p>æšä¸¾æ‰€æœ‰å¯èƒ½çš„ä»£ç å¾ˆå¥½å®ç°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenerateParenthesis</span><span class="params">(n <span class="type">int</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">int</span>, <span class="type">string</span>)</span></span></span><br><span class="line">	<span class="keyword">var</span> res = <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>)</span><br><span class="line">	n = n * <span class="number">2</span></span><br><span class="line">	backtrack = <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>, back <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">			res = <span class="built_in">append</span>(res, back)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">		backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;(&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	backtrack(n, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h4><p>é€’å½’ä¸ºä»€ä¹ˆå¯å®ç°æšä¸¾ï¼Ÿ</p><p>åˆ†æè¿‡ç¨‹:</p><p>å¦‚æœè¾“å…¥ä¸º2ï¼Œè¦ç”Ÿæˆ2nä¸ªæ‹¬å·å¯å¾—å‡ºn&#x3D;4,å› ä¸ºå‡½æ•°æ˜¯åœ¨<code>æ ˆ</code>ä¸­è°ƒç”¨çš„,å¹¶ä¸”é€’å½’åµŒå¥—è°ƒç”¨<br>æ‰€ä»¥å½“ï¼š</p><ul><li><p>n&#x3D;1æ—¶:<code>backtrack(0, back + &quot;)&quot;)</code>å’Œ<code>backtrack(0, back + &quot;(&quot;)</code>éƒ½è¢«å‹å…¥åˆ°æ ˆä¸­</p></li><li><p>n&#x3D;2æ—¶:<code>backtrack(1, back + &quot;)&quot;)</code>å’Œ<code>backtrack(1, back + &quot;(&quot;)</code>éƒ½è¢«å‹å…¥åˆ°æ ˆä¸­</p></li><li><p>n&#x3D;3æ—¶:<code>backtrack(2, back + &quot;)&quot;)</code>å’Œ<code>backtrack(3, back + &quot;(&quot;)</code>éƒ½è¢«å‹å…¥åˆ°æ ˆä¸­</p></li><li><p>n&#x3D;4æ—¶:<code>backtrack(3, back + &quot;)&quot;)</code>å’Œ<code>backtrack(3, back + &quot;(&quot;)</code>éƒ½è¢«å‹å…¥åˆ°æ ˆä¸­</p></li></ul><p>ä¸éš¾åˆ†æï¼Œå½“:</p><ul><li><p>n&#x3D;0æ—¶ä¸ºç»ˆæ­¢æ¡ä»¶ï¼Œç›´æ¥è¾“å‡º</p></li><li><p>n&#x3D;1æ—¶<code>n = n-1</code> å‡½æ•°è°ƒç”¨ä¸º<code>backtrack(0, back + &quot;)&quot;)</code>,å¯¹åº”äº†ä¸¤ç§ç»“æœé›†ï¼š<code>)</code>å’Œ<code>(</code>éƒ½è¢«å‹å…¥æ ˆä¸­,ä¼šè¾“å‡º<code>)</code>å’Œ<code>(</code>ä¸¤ç§å¯èƒ½;å‡½æ•°è¢«å‹å…¥æ ˆä¸­2æ¬¡</p></li><li><p>n&#x3D;2æ—¶<code>n = n-1</code> å‡½æ•°è°ƒç”¨ä¸º<code>backtrack(1, back + &quot;)&quot;)</code>,å¯¹åº”äº†åˆšæ‰n&#x3D;1æ—¶ä¸¤ç§è¾“å‡ºç»“æœé›†;<code>backtrack(1, back + &quot;(&quot;)</code>ä¹Ÿå¯¹åº”äº†n&#x3D;1çš„ä¸¤ç§è¾“å‡ºç»“æœé›†,æƒ³åŠ åä¸€å…±ä¼šè¾“å‡º<code>))</code>ã€<code>((</code>ã€<code>()</code>ã€<code>)(</code>å››ç§å¯èƒ½;å‡½æ•°è¢«å‹å…¥æ ˆä¸­4æ¬¡</p></li><li><p>n&#x3D;3æ—¶<code>n = n-1</code> å‡½æ•°è°ƒç”¨ä¸º<code>backtrack(2, back + &quot;)&quot;)</code>,å¯¹åº”äº†åˆšæ‰n&#x3D;2æ—¶çš„ä¸¤ç§è¾“å‡ºç»“æœé›†;<code>backtrack(2, back + &quot;(&quot;)</code>ä¹Ÿå¯¹åº”äº†n&#x3D;2çš„ä¸¤ç§è¾“å‡ºç»“æœé›†,æƒ³åŠ åä¸€å…±ä¼šè¾“å‡º<code>)))</code> <code>))(</code> <code>)()</code> <code>)((</code> <code>())</code> <code>()(</code> <code>(()</code> <code>(((</code>å…«ç§å¯èƒ½;å‡½æ•°è¢«å‹å…¥æ ˆä¸­8æ¬¡</p></li><li><p>n&#x3D;4æ—¶<code>n = n-1</code> å‡½æ•°è°ƒç”¨ä¸º<code>backtrack(3, back + &quot;)&quot;)</code>,å¯¹åº”äº†åˆšæ‰n&#x3D;3æ—¶çš„ä¸¤ç§è¾“å‡ºç»“æœé›†;<code>backtrack(3, back + &quot;(&quot;)</code>ä¹Ÿå¯¹åº”äº†n&#x3D;3çš„ä¸¤ç§è¾“å‡ºç»“æœé›†,æƒ³åŠ åä¸€å…±ä¼šè¾“å‡ºâ€¦åå…­ç§å¯èƒ½;å‡½æ•°è¢«å‹å…¥æ ˆä¸­16æ¬¡</p></li><li><p>n&#x3D;xæ—¶<code>n = x-1</code> å‡½æ•°è°ƒç”¨ä¸º<code>backtrack(x-1, back + &quot;)&quot;)</code>å’Œ<code>backtrack(x-1, back + &quot;(&quot;)</code>å¯¹åº”äº†<code>2 * (backtrack(x-1))</code>ç§å¯èƒ½);å‡½æ•°è¢«å‹å…¥æ ˆä¸­æ¬¡<code>2 * (backtrack(x-1))</code>æ¬¡</p></li></ul><blockquote><p>æ€»ç»“ï¼šæšä¸¾ä¸åŒå¯èƒ½æ˜¯ä¸€ä¸ªä¸æ–­æœç´¢å°è¯•çš„è¿‡ç¨‹ï¼Œç”±äºæšä¸¾è¿‡ç¨‹éœ€è¦ä¿å­˜ä¸Šä¸€æ¬¡æšä¸¾çš„ç»“æœé›†ï¼Œè€Œå‡½æ•°å‚æ•°å€¼åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¼šä¿å­˜ä¸‹æ¥ï¼Œåˆ©ç”¨è¿™ä¸€ç‰¹æ€§æˆ‘ä»¬åªè¦åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶ä¸­ï¼Œå°†é€’å½’åçš„ç»“æœé›†ä¿å­˜ä¸‹æ¥å°±å¯ä»¥ç©·ä¸¾å‡ºæ‰€æœ‰å¯èƒ½ã€‚</p></blockquote><h4 id="å‰ªæ"><a href="#å‰ªæ" class="headerlink" title="å‰ªæ"></a>å‰ªæ</h4><p>å‰ªæå°±æ˜¯åœ¨ç©·ä¸¾çš„ç»“æœé›†ä¸­è¿‡æ»¤åˆ°ä¸åˆæ³•çš„ç»“æœé›†</p><p>æ ¹æ®é¢˜æ„å¯åˆ†æåˆ°å‰ªææ¡ä»¶:</p><ul><li><p>å·¦æ‹¬å·æ•°é‡ä¸èƒ½è¶…å‡ºn&#x2F;2</p></li><li><p>å·¦æ‹¬å·ä¸€å®šè¦å…ˆäºå³æ‹¬å·å‡ºç°</p></li><li><p>å³æ‹¬å·æ•°é‡ä¸èƒ½è¶…å‡ºn&#x2F;2</p></li></ul><p>æ‰€ä»¥æˆ‘ä»¬è¦åœ¨é€’å½’è°ƒç”¨ä¸­å¢åŠ å‡½æ•°å‚æ•°ï¼Œæ¥ä¿å­˜å·¦æ‹¬å·å’Œå³æ‹¬å·å‡ºç°çš„æ¬¡æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">int</span>, <span class="type">string</span>, <span class="type">int</span>, <span class="type">int</span>)</span></span></span><br><span class="line">backtrack = <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>, back <span class="type">string</span>, left, right <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;)&quot;</span>, left, right + <span class="number">1</span>) <span class="comment">// é€šè¿‡right+1å®ç°å³æ‹¬å·è®¡æ•°</span></span><br><span class="line">    backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;(&quot;</span>, left + <span class="number">1</span>, right) <span class="comment">// é€šè¿‡left+1å®ç°å·¦æ‹¬å·è®¡æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®åˆšæ‰çš„å‰ªæåˆ†æå¢åŠ åˆ¤æ–­æ¡ä»¶</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿…é¡»å…ˆä¿è¯å·¦æ‹¬å·å…ˆå‡ºç°ï¼Œæ‰èƒ½å‡ºç°å³æ‹¬å·</span></span><br><span class="line"><span class="keyword">if</span> left &gt; right &#123;</span><br><span class="line">    backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;)&quot;</span>, left, right + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å½“å·¦æ‹¬å·å‡ºç°è¶…è¿‡n/2æ—¶ï¼Œå‰ªæ‰å¤šä½™çš„å·¦æ‹¬å·ï¼Œå¹¶ä¸”åªæ·»åŠ å³æ‹¬å·</span></span><br><span class="line"><span class="keyword">if</span> left &lt; n / <span class="number">2</span> &#123;</span><br><span class="line">    backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;(&quot;</span>, left + <span class="number">1</span>, right)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç”±äºä¿è¯äº†leftå‡ºç°æ¬¡æ•°ä¸ä¼šè¶…è¿‡n&#x2F;2,å¹¶ä¸”æ€»å‡ºç°æ¬¡æ•°é™åˆ¶ä¸ºnï¼ˆn&#x3D;0æ—¶å‡½æ•°ä¼šé€€å‡ºï¼‰ï¼Œæ‰€ä»¥å³æ‹¬å·æ•°é‡ä¸èƒ½è¶…å‡ºn&#x2F;2çš„åˆ¤æ–­ä»£ç ä¸ç”¨å®ç°</p></blockquote><p>ç”±äºå‡½æ•°åœ¨é€’å½’è°ƒç”¨è¿‡ç¨‹ä¸­,nç”±äºå‡1ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å…¨å±€å˜é‡ä¸­å£°æ˜<code>m</code>å¹¶ä¿å­˜<code>n</code>çš„åˆå§‹å€¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">int</span>, <span class="type">string</span>, <span class="type">int</span>, <span class="type">int</span>)</span></span></span><br><span class="line">n = n * <span class="number">2</span></span><br><span class="line">m := n</span><br><span class="line">backtrack = <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>, back <span class="type">string</span>, left, right <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;)&quot;</span>, left, right + <span class="number">1</span>) <span class="comment">// é€šè¿‡right+1å®ç°å³æ‹¬å·è®¡æ•°</span></span><br><span class="line">    backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;(&quot;</span>, left + <span class="number">1</span>, right) <span class="comment">// é€šè¿‡left+1å®ç°å·¦æ‹¬å·è®¡æ•°</span></span><br><span class="line">    <span class="keyword">if</span> left &gt; right &#123;</span><br><span class="line">        backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;)&quot;</span>, left, right + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å½“å·¦æ‹¬å·å‡ºç°è¶…è¿‡n/2æ—¶ï¼Œå‰ªæ‰å¤šä½™çš„å·¦æ‹¬å·ï¼Œå¹¶ä¸”åªæ·»åŠ å³æ‹¬å·</span></span><br><span class="line">    <span class="keyword">if</span> left &lt; m / <span class="number">2</span> &#123;</span><br><span class="line">        backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;(&quot;</span>, left + <span class="number">1</span>, right)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®Œæ•´ä»£ç ç¤ºä¾‹"><a href="#å®Œæ•´ä»£ç ç¤ºä¾‹" class="headerlink" title="å®Œæ•´ä»£ç ç¤ºä¾‹"></a>å®Œæ•´ä»£ç ç¤ºä¾‹</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateParenthesis</span><span class="params">(n <span class="type">int</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> backtrack <span class="function"><span class="keyword">func</span> <span class="params">(<span class="type">int</span>, <span class="type">string</span>, <span class="type">int</span>, <span class="type">int</span>)</span></span></span><br><span class="line">	<span class="keyword">var</span> res = <span class="built_in">make</span>([]<span class="type">string</span>, <span class="number">0</span>)</span><br><span class="line">	n = n * <span class="number">2</span></span><br><span class="line">	m := n</span><br><span class="line">	backtrack = <span class="function"><span class="keyword">func</span><span class="params">(n <span class="type">int</span>, back <span class="type">string</span>, left, right <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> n == <span class="number">0</span> &#123;</span><br><span class="line">			res = <span class="built_in">append</span>(res, back)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//å¿…é¡»å…ˆä¿è¯å·¦æ‹¬å·å…ˆå‡ºç°ï¼Œæ‰èƒ½å‡ºç°å³æ‹¬å·</span></span><br><span class="line">		<span class="keyword">if</span> left &gt; right &#123;</span><br><span class="line">			backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;)&quot;</span>, left, right + <span class="number">1</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//å½“å·¦æ‹¬å·å‡ºç°è¶…è¿‡n/2æ—¶ï¼Œå‰ªæ‰å¤šä½™çš„å·¦æ‹¬å·ï¼Œå¹¶ä¸”åªæ·»åŠ å³æ‹¬å·</span></span><br><span class="line">		<span class="keyword">if</span> left &lt; m / <span class="number">2</span> &#123;</span><br><span class="line">			backtrack(n- <span class="number">1</span>, back + <span class="string">&quot;(&quot;</span>, left + <span class="number">1</span>, right)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	backtrack(n, <span class="string">&quot;&quot;</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2022-01-15/img.png" alt="img.png"></p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2021/06/02/2021-06-01-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2021/06/02/2021-06-01-%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/" class="post-title-link" itemprop="url">è¿›ç¨‹ä¸çº¿ç¨‹</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-06-02 19:30:00" itemprop="dateCreated datePublished" datetime="2021-06-02T19:30:00+08:00">2021-06-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="è¿›ç¨‹å’Œçº¿ç¨‹"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹"></a>è¿›ç¨‹å’Œçº¿ç¨‹</h1><p>è¿›ç¨‹ä¸ºæ“ä½œç³»ç»Ÿæä¾›äº†ä¼ª(å¹¶è¡Œ)çš„èƒ½åŠ›ï¼Œçº¿ç¨‹æé«˜äº†æ“ä½œç³»ç»Ÿä¼ª(å¹¶è¡Œ)çš„èƒ½åŠ›ï¼Œæ²¡æœ‰è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œç°ä»£è®¡ç®—æ˜¯ä¸å¤å­˜åœ¨çš„<br>ä»¥ä¸‹å†…å®¹å‡ä¸º<code>UNIX</code>æ“ä½œç³»ç»Ÿä¸­æè¿°</p><h2 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h2><p>åœ¨è¿›ç¨‹æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰åœ¨è®¡ç®—æœºä¸Šå¯è¿è¡Œçš„è½¯ä»¶ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿï¼Œè¢«ç»„ç»‡æˆè‹¥å¹²<strong>é¡ºåºè¿›ç¨‹</strong>ï¼Œç®€ç§°<strong>è¿›ç¨‹</strong></p><h3 id="è¿›ç¨‹æ¨¡å‹"><a href="#è¿›ç¨‹æ¨¡å‹" class="headerlink" title="è¿›ç¨‹æ¨¡å‹"></a>è¿›ç¨‹æ¨¡å‹</h3><p>ä¸€ä¸ªè¿›ç¨‹åŒ…å«ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨å’Œå˜é‡å½“å‰çš„å€¼ï¼Œä»æ¦‚å¿µä¸Šæ¥è®²ï¼Œæ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰è‡ªå·±çš„cpuï¼Œå®é™…ä¸Šæ˜¯cpuåœ¨è¿›ç¨‹é—´ä¸æ–­çš„åˆ‡æ¢å¯¼è‡´çš„é”™è§‰ï¼Œè¿™ç§å¿«é€Ÿåˆ‡æ¢ç§°ä¸º<strong>å¤šé“ç¨‹åºè®¾è®¡</strong><br>å¯¹äºç”¨æˆ·è¿›ç¨‹ï¼Œå…¶æ—¢æœ‰ç”¨æˆ·åœ°å€ç©ºé—´ä¸­çš„æ ˆï¼Œä¹Ÿæœ‰å®ƒè‡ªå·±çš„å†…æ ¸æ ˆã€‚è€Œå†…æ ¸è¿›ç¨‹å°±åªæœ‰å†…æ ¸æ ˆã€‚</p><table><thead><tr><th>æ¯ä¸ªè¿›ç¨‹çš„å†…å®¹</th></tr></thead><tbody><tr><td>åœ°å€ç©ºé—´</td></tr><tr><td>å…¨å±€å˜é‡</td></tr><tr><td>æ‰“å¼€æ–‡ä»¶</td></tr><tr><td>å­è¿›ç¨‹</td></tr><tr><td>å®šæ—¶å™¨</td></tr><tr><td>ä¿¡å·å’Œä¿¡å·å¤„ç†ç¨‹åº</td></tr><tr><td>è´¦æˆ·ä¿¡æ¯</td></tr></tbody></table><h4 id="å¤šé“ç¨‹åºè®¾è®¡æ¨¡å‹"><a href="#å¤šé“ç¨‹åºè®¾è®¡æ¨¡å‹" class="headerlink" title="å¤šé“ç¨‹åºè®¾è®¡æ¨¡å‹"></a>å¤šé“ç¨‹åºè®¾è®¡æ¨¡å‹</h4><p>é‡‡ç”¨å¤šé“ç¨‹åºè®¾è®¡å¯æé«˜cpuçš„åˆ©ç”¨ç‡</p><p>cpuåˆ©ç”¨ç‡è®¡ç®—å…¬å¼:<code>1-p^n</code></p><p>pè¡¨ç¤ºè¿›ç¨‹ç­‰å¾…æ—¶é—´å’Œè¿è¡Œæ—¶é—´çš„ä¹‹æ¯”,nè¡¨ç¤ºå¤šé“ç¨‹åºè®¾è®¡çš„é“æ•°<br>ä¾‹å¦‚ï¼šä¸€ä¸ª8gå†…å­˜çš„æ“ä½œç³»ç»Ÿï¼Œæ“ä½œç³»ç»Ÿå äº†2G,æ¯ä¸ªåº”ç”¨ç¨‹åºå äº†2G,å‡å¦‚æ¯ä¸ªåº”ç”¨ç¨‹åº80%çš„æ—¶é—´éƒ½å¤„äºIOç­‰å¾…ï¼Œé‚£ä¹ˆcpuåˆ©ç”¨ç‡ç­‰äº<code>1-0.8^3</code>çº¦ä¸º49%<br>è¿™æ—¶å€™ï¼Œå¢åŠ 8gå†…å­˜ï¼Œè¿è¡Œç¨‹åºæ•°é‡ï¼Œå¯ä»3é“ç¨‹åºè®¾è®¡æé«˜åˆ°7é“ï¼Œcpuåˆ©ç”¨ç‡ä¸º1-0.8^7,cpuåˆ©ç”¨ç‡æå‡åˆ°79%</p><p>å¦‚æœåœ¨å¢åŠ 8gå†…å­˜ï¼Œcpuåˆ©ç”¨ç‡åªèƒ½ç”±79%æå‡åˆ°91%ï¼Œæ˜¾ç„¶ä¸å¦‚ä¹‹å‰çš„ç¬¬ä¸€ç§æŠ•èµ„å¥½</p><h3 id="è¿›ç¨‹åˆ›å»º"><a href="#è¿›ç¨‹åˆ›å»º" class="headerlink" title="è¿›ç¨‹åˆ›å»º"></a>è¿›ç¨‹åˆ›å»º</h3><p>è¿›ç¨‹åˆ›å»ºä¸»è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨<code>fork</code>å‡½æ•°æ¥å®ç°çš„ï¼Œè°ƒç”¨åä¼šåˆ›å»ºåä¼šåˆ›å»ºä¸€ä¸ªä¸è°ƒç”¨è¿›ç¨‹ç›¸åŒçš„å‰¯æœ¬ï¼Œç§°ä¹‹ä¸º<strong>å­è¿›ç¨‹</strong>ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹æ‹¥æœ‰ç›¸åŒçš„å†…å­˜é•œåƒï¼Œä»–ä»¬æ‹¥æœ‰å„è‡ªä¸åŒçš„åœ°å€ç©ºé—´ï¼Œå…¶ä¸­ä¸å¯å†™çš„å†…å­˜åŒºåŸŸæ˜¯å¯å…±äº«çš„ã€‚å¯å†™çš„å†…å­˜åŒºæ˜¯ä¸å…±äº«çš„ï¼Œé€šè¿‡<strong>å†™æ—¶å¤åˆ¶</strong>å…±äº«</p><h3 id="è¿›ç¨‹ç»ˆæ­¢"><a href="#è¿›ç¨‹ç»ˆæ­¢" class="headerlink" title="è¿›ç¨‹ç»ˆæ­¢"></a>è¿›ç¨‹ç»ˆæ­¢</h3><p>è¿›ç¨‹ç»ˆæ­¢ç”±ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶å¼•èµ·</p><ul><li>æ­£å¸¸é€€å‡ºï¼ˆè‡ªæ„¿ï¼‰</li><li>å‡ºé”™é€€å‡ºï¼ˆè‡ªæ„¿ï¼‰</li><li>ä¸¥é‡é”™è¯¯é€€å‡ºï¼ˆéè‡ªæ„¿ï¼‰</li><li>è¢«å…¶ä»–è¿›ç¨‹æ€æ­»é€€å‡ºï¼ˆéè‡ªæ„¿ï¼‰</li></ul><h3 id="è¿›ç¨‹çŠ¶æ€"><a href="#è¿›ç¨‹çŠ¶æ€" class="headerlink" title="è¿›ç¨‹çŠ¶æ€"></a>è¿›ç¨‹çŠ¶æ€</h3><ul><li>è¿è¡Œæ€</li><li>å°±ç»ªæ€</li><li>é˜»å¡æ€</li></ul><p>å‰ä¸¤ç§çŠ¶æ€æ˜¯ç±»ä¼¼çš„ï¼ŒåŒºåˆ«æ˜¯ç¬¬äºŒç§çŠ¶æ€æ²¡æœ‰åˆ†é…cpuèµ„æºï¼Œç¬¬ä¸‰ç§çŠ¶æ€ä¸å‰ä¸¤ç§ä¸åŒï¼Œå¤„äºè¯¥çŠ¶æ€è¿›ç¨‹ä¸èƒ½è¿è¡Œï¼Œå³ä½¿cpuæ˜¯ç©ºé—²çš„</p><h3 id="è¿›ç¨‹å®ç°"><a href="#è¿›ç¨‹å®ç°" class="headerlink" title="è¿›ç¨‹å®ç°"></a>è¿›ç¨‹å®ç°</h3><p>æ“ä½œç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªè¡¨æ ¼ï¼ˆç»“æ„æ•°ç»„æˆ–é“¾è¡¨ï¼‰å³è¿›ç¨‹è¡¨ï¼Œè¯¥è¡¨åŒ…å«äº†è¿›ç¨‹çŠ¶æ€çš„é‡è¦ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¨‹åºå„ç§çŠ¶æ€è½¬æ¢æ—¶å¿…é¡»ä¿å­˜çš„ä¿¡æ¯ï¼Œä»è€Œä¿è¯è¿›ç¨‹å†æ¬¡å¯åŠ¨æ—¶ï¼Œåƒä»æœªä¸­æ–­è¿‡ä¸€æ ·</p><table><thead><tr><th>è¿›ç¨‹ç®¡ç†</th><th>å­˜å‚¨ç®¡ç†</th><th>æ–‡ä»¶ç®¡ç†</th></tr></thead><tbody><tr><td>å¯„å­˜å™¨</td><td>æ­£æ–‡æ®µæŒ‡é’ˆ</td><td>æ ¹ç›®å½•</td></tr><tr><td>ç¨‹åºè®¡æ•°å™¨</td><td>æ•°æ®æ®µæŒ‡é’ˆ</td><td>å·¥ä½œç›®å½•</td></tr><tr><td>ç¨‹åºçŠ¶æ€å­—</td><td>å †æ ˆæ®µæŒ‡é’ˆ</td><td>æ–‡ä»¶æè¿°ç¬¦</td></tr><tr><td>å †æ ˆæŒ‡é’ˆ</td><td></td><td>ç”¨æˆ·id</td></tr><tr><td>è¿›ç¨‹çŠ¶æ€</td><td></td><td>ç»„id</td></tr><tr><td>ä¼˜å…ˆçº§</td><td></td><td></td></tr><tr><td>è°ƒåº¦å‚æ•°</td><td></td><td></td></tr><tr><td>è¿›ç¨‹id</td><td></td><td></td></tr><tr><td>çˆ¶è¿›ç¨‹</td><td></td><td></td></tr><tr><td>è¿›ç¨‹ç»„</td><td></td><td></td></tr><tr><td>ä¿¡å·</td><td></td><td></td></tr><tr><td>è¿›ç¨‹å¼€å§‹æ—¶é—´</td><td></td><td></td></tr><tr><td>ä½¿ç”¨cpuçš„æ—¶é—´</td><td></td><td></td></tr><tr><td>å­è¿›ç¨‹cpuæ—¶é—´</td><td></td><td></td></tr><tr><td>ä¸‹æ¬¡å®šæ—¶å™¨æ—¶é—´</td><td></td><td></td></tr></tbody></table><h3 id="è¿›ç¨‹åˆ†ç±»"><a href="#è¿›ç¨‹åˆ†ç±»" class="headerlink" title="è¿›ç¨‹åˆ†ç±»"></a>è¿›ç¨‹åˆ†ç±»</h3><ul><li><strong>ç³»ç»Ÿè¿›ç¨‹</strong>ï¼šå¯ä»¥æ‰§è¡Œå†…å­˜èµ„æºåˆ†é…å’Œè¿›ç¨‹åˆ‡æ¢ç­‰ç®¡ç†å·¥ä½œï¼›è€Œä¸”ï¼Œè¯¥è¿›ç¨‹çš„è¿è¡Œä¸å—ç”¨æˆ·çš„å¹²é¢„ï¼Œå³ä½¿æ˜¯rootç”¨æˆ·ä¹Ÿä¸èƒ½å¹²é¢„ç³»ç»Ÿè¿›ç¨‹çš„è¿è¡Œã€‚</li><li><strong>ç”¨æˆ·è¿›ç¨‹</strong>ï¼šé€šè¿‡æ‰§è¡Œç”¨æˆ·ç¨‹åºã€åº”ç”¨ç¨‹åºæˆ–å†…æ ¸ä¹‹å¤–çš„ç³»ç»Ÿç¨‹åºè€Œäº§ç”Ÿçš„è¿›ç¨‹ï¼Œæ­¤ç±»è¿›ç¨‹å¯ä»¥åœ¨ç”¨æˆ·çš„æ§åˆ¶ä¸‹è¿è¡Œæˆ–å…³é—­ã€‚</li><li><strong>é’ˆå¯¹ç”¨æˆ·è¿›ç¨‹</strong>:åˆå¯ä»¥åˆ†ä¸ºäº¤äº’è¿›ç¨‹ã€æ‰¹å¤„ç†è¿›ç¨‹å’Œå®ˆæŠ¤è¿›ç¨‹ä¸‰ç±»ã€‚</li><li><strong>äº¤äº’è¿›ç¨‹</strong>ï¼šç”±ä¸€ä¸ªshellç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’æ“ä½œï¼Œå¯ä»¥è¿è¡Œäºå‰å°ï¼Œä¹Ÿå¯ä»¥è¿è¡Œåœ¨åå°ã€‚</li><li><strong>æ‰¹å¤„ç†è¿›ç¨‹</strong>ï¼šè¯¥è¿›ç¨‹æ˜¯ä¸€ä¸ªè¿›ç¨‹é›†åˆï¼Œè´Ÿè´£æŒ‰é¡ºåºå¯åŠ¨å…¶ä»–çš„è¿›ç¨‹ã€‚</li><li><strong>å®ˆæŠ¤è¿›ç¨‹</strong>:å®ˆæŠ¤è¿›ç¨‹æ˜¯ä¸€ç›´è¿è¡Œçš„ä¸€ç§è¿›ç¨‹ï¼Œç»å¸¸åœ¨linuxç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ï¼Œåœ¨ç³»ç»Ÿå…³é—­æ—¶ç»ˆæ­¢ã€‚å®ƒä»¬ç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶ä¸”å‘¨æœŸæ€§çš„æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›å‘ç”Ÿçš„äº‹ä»¶ã€‚ä¾‹å¦‚httpdè¿›ç¨‹ï¼Œä¸€ç›´å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œç­‰å¾…ç”¨æˆ·çš„è®¿é—®ã€‚è¿˜æœ‰ç»å¸¸ç”¨çš„crondè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹ç±»ä¼¼ä¸windowsçš„è®¡åˆ’ä»»åŠ¡ï¼Œå¯ä»¥å‘¨æœŸæ€§çš„æ‰§è¡Œç”¨æˆ·è®¾å®šçš„æŸäº›ä»»åŠ¡</li></ul><h2 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h2><p>çº¿ç¨‹æ˜¯cpuæ‰§è¡Œçš„æœ€å°å•å…ƒï¼Œæ¯”è¿›ç¨‹æ›´è½»é‡çº§ï¼Œæ›´å®¹æ˜“åˆ›å»ºæˆ–æ’¤é”€</p><h3 id="çº¿ç¨‹æ¨¡å‹"><a href="#çº¿ç¨‹æ¨¡å‹" class="headerlink" title="çº¿ç¨‹æ¨¡å‹"></a>çº¿ç¨‹æ¨¡å‹</h3><p>çº¿ç¨‹ä¹ŸåŒ…å«ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨å’Œè‡ªå·±çš„å †æ ˆ</p><p>è¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹ä¸åƒä¸åŒè¿›ç¨‹é‚£æ ·å­˜åœ¨å¾ˆå¤§çš„ç‹¬ç«‹æ€§ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æœ‰å®Œå…¨ä¸€æ ·çš„åœ°å€ç©ºé—´ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥å…±äº«å…¨å±€å˜é‡</p><table><thead><tr><th>æ¯ä¸ªçº¿ç¨‹çš„å†…å®¹</th></tr></thead><tbody><tr><td>ç¨‹åºè®¡æ•°å™¨</td></tr><tr><td>å¯„å­˜å™¨</td></tr><tr><td>å †æ ˆ</td></tr><tr><td>çŠ¶æ€</td></tr></tbody></table><p>æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å †æ ˆï¼ŒåŸå› æ˜¯ï¼š<br>çº¿ç¨‹è°ƒç”¨æ—¶éœ€è¦ä½¿ç”¨æ ˆå¸§å­˜æ”¾å±€éƒ¨å˜é‡å’Œè°ƒç”¨åè¿”å›çš„åœ°å€ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨çš„è¿‡ç¨‹æ˜¯ä¸åŒï¼Œè¦å•ç‹¬ç»´æŠ¤ä¸€å¥—è‡ªå·±çš„æ‰§è¡Œå†å²</p><h3 id="çº¿ç¨‹çš„ä½¿ç”¨"><a href="#çº¿ç¨‹çš„ä½¿ç”¨" class="headerlink" title="çº¿ç¨‹çš„ä½¿ç”¨"></a>çº¿ç¨‹çš„ä½¿ç”¨</h3><p>éœ€è¦å¤šçº¿ç¨‹çš„åŸå› æœ‰ä¸¤ä¸ªï¼Œ</p><ul><li>å¹¶è¡Œå®ä½“æ‹¥æœ‰åŒä¸€ä¸ªåœ°å€ç©ºé—´å’Œæ‰€æœ‰å¯ç”¨æ•°æ®çš„èƒ½åŠ›</li><li>çº¿ç¨‹æ¯”è¿›ç¨‹æ›´è½»é‡çº§ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¯”è¿›ç¨‹å¿«10-100å€ï¼Œå½“æœ‰å¤§é‡çº¿ç¨‹éœ€è¦åŠ¨æ€å’Œå¿«é€Ÿä¿®æ”¹æ—¶ï¼Œè¿™ä¸€ç‰¹æ€§å¾ˆæœ‰å¿…è¦</li></ul><h3 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h3><p>åŒè¿›ç¨‹ä¸€æ ·ï¼Œçº¿ç¨‹ä¹Ÿå¯ä»¥å¤„äºè¿è¡Œã€é˜»å¡ã€å°±ç»ªæˆ–ç»ˆæ­¢çŠ¶æ€</p><h3 id="çº¿ç¨‹å®ç°æ–¹å¼"><a href="#çº¿ç¨‹å®ç°æ–¹å¼" class="headerlink" title="çº¿ç¨‹å®ç°æ–¹å¼"></a>çº¿ç¨‹å®ç°æ–¹å¼</h3><h4 id="åœ¨ç”¨æˆ·ç©ºé—´å®ç°"><a href="#åœ¨ç”¨æˆ·ç©ºé—´å®ç°" class="headerlink" title="åœ¨ç”¨æˆ·ç©ºé—´å®ç°"></a>åœ¨ç”¨æˆ·ç©ºé—´å®ç°</h4><p>æ•´ä¸ªçº¿ç¨‹åŒ…å¤„äºç”¨æˆ·ç©ºé—´ï¼Œä»å†…æ ¸è§’åº¦è€ƒè™‘ï¼Œå°±æ˜¯æŒ‰æ­£å¸¸å•è¿›ç¨‹å•çº¿ç¨‹æ–¹å¼ç®¡ç†ï¼Œè¿™ç§æ–¹å¼å¥½å¤„æ˜¯æœ‰äº›æ“ä½œç³»ç»Ÿå†…æ ¸ä¸æ”¯æŒå¤šçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥ä¸€æ ·ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹</p><p>ç”¨æˆ·ç©ºé—´çº¿ç¨‹é™¤äº†è¿™ç‚¹å¥½å¤„ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ç‚¹ä¼˜åŠ¿ï¼š</p><ul><li>çº¿ç¨‹çš„çŠ¶æ€å’Œè°ƒåº¦ä¿å­˜æ˜¯æœ¬åœ°è¿‡ç¨‹ï¼Œä¸éœ€è¦å†…æ ¸æ¥å‚ä¸ï¼Œä¹Ÿé¿å…äº†ä¸Šä¸‹é—®åˆ‡æ¢ï¼Œcpuå†…å­˜é«˜é€Ÿç¼“å­˜åˆ·æ–°ï¼Œè°ƒåº¦æ•æ·</li><li>å…è®¸æ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„è°ƒåº¦ç®—æ³•ï¼Œä¾‹å¦‚ï¼Œåœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­æœ‰åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œåº”ç”¨ç¨‹åºä¸éœ€è¦æ‹…å¿ƒçº¿ç¨‹ä¼šåœ¨ä¸åˆé€‚çš„æ—¶åˆ»åœæ­¢</li><li>æ‹¥æœ‰å¾ˆå¥½çš„æ‰©å±•æ€§ï¼Œå†…æ ¸çº¿ç¨‹åœ¨å†…æ ¸ç©ºé—´éœ€è¦å›ºå®šçš„è¡¨æ ¼ç©ºé—´å’Œå †æ ˆç©ºé—´ï¼Œå¦‚æœå†…æ ¸çº¿ç¨‹æ•°é‡éå¸¸å¤§ï¼Œä¼šå‡ºç°é—®é¢˜</li></ul><p>å½“ç„¶ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›ä¸å¯é¿å…çš„ç¼ºç‚¹ï¼š</p><ul><li>ç”¨æˆ·ç©ºé—´çº¿ç¨‹å»åšç³»ç»Ÿçº§è°ƒç”¨æ˜¯ä¸å¯æ¥å—çš„ï¼Œä¼šåœæ­¢æ‰€æœ‰çš„çº¿ç¨‹ï¼Œè€Œå®ç°çº¿ç¨‹çš„ç›®æ ‡æ˜¯è¦å…è®¸æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨é˜»å¡è°ƒç”¨ï¼Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹ï¼Œç›¸è¿èƒŒ</li><li>è¯¥çº¿ç¨‹è¿è¡Œæ—¶ï¼Œè¿›ç¨‹å†…å…¶ä»–çº¿ç¨‹ä¸èƒ½è¿è¡Œï¼Œé™¤éè¯¥çº¿ç¨‹æ”¾å¼ƒcpu</li></ul><h4 id="åœ¨å†…æ ¸å®ç°"><a href="#åœ¨å†…æ ¸å®ç°" class="headerlink" title="åœ¨å†…æ ¸å®ç°"></a>åœ¨å†…æ ¸å®ç°</h4><p>å†…æ ¸çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­ä¿å­˜äº†æ¯ä¸ªçº¿ç¨‹çš„å¯„å­˜å™¨ã€çŠ¶æ€ã€å’Œå…¶ä»–ä¿¡æ¯ï¼Œè·Ÿç”¨æˆ·ç©ºé—´çº¿ç¨‹æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«æ˜¯ä¿å­˜åœ¨äº†å†…æ ¸ä¸­</p><p>å†…æ ¸çº¿ç¨‹çš„ç®¡ç†å·¥ä½œç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®Œæˆï¼Œè¿™ç§å®ç°çš„å¥½å¤„æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹é˜»å¡æ—¶ï¼Œå†…æ ¸æ ¹æ®é€‰æ‹©ï¼Œå¯ä»¥åˆ‡æ¢åˆ°è¿›ç¨‹å†…å¦ä¸€ä¸ªçº¿ç¨‹<br>å¦‚æœå½“æŸä¸ªçº¿ç¨‹å¼•å‘äº†é¡µé¢æ•…éšœï¼Œå†…æ ¸å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ£€æµ‹æ˜¯å¦æœ‰å…¶ä»–å¯ç”¨çš„çº¿ç¨‹ï¼Œè®©å…¶æ‰§è¡Œ</p><p>è™½ç„¶å†…æ ¸è§£å†³äº†çº¿ç¨‹å¾ˆå¤šé—®é¢˜ï¼Œä½†ä¹Ÿä¸ä¼šè§£å†³æ‰€æœ‰é—®é¢˜ï¼Œæ¯”å¦‚å½“ä¸€ä¸ªæ–°è¿›ç¨‹åˆ›å»ºï¼Œæ˜¯å°†è¿›ç¨‹é‡Œçš„æ‰€æœ‰çº¿ç¨‹éƒ½å¤åˆ¶ï¼Œè¿˜æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ<br>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯å½“è¿‡æ¥ä¸€ä¸ªä¿¡å·ï¼Œå¯ä»¥äº¤ç»™éœ€è¦çš„çº¿ç¨‹æ‰§è¡Œï¼Œå½“æ—¶å¤šä¸ªçº¿ç¨‹éƒ½æ³¨å†Œäº†è¯¥ä¿¡å·ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><h4 id="æ··åˆå®ç°"><a href="#æ··åˆå®ç°" class="headerlink" title="æ··åˆå®ç°"></a>æ··åˆå®ç°</h4><p>æ··åˆå®ç°ä¸»è¦åˆ†ä¸ºç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹å¤šå¯¹1ã€1å¯¹1ã€å’Œå¤šå¯¹å¤šæ¨¡å¼ï¼Œå…¶ä¸­å¤šå¯¹1æ¨¡å¼å°±æ˜¯å‰é¢ä»‹ç»çš„åœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„çº¿ç¨‹æ¨¡å‹ï¼Œçº¿ç¨‹ä¸­ä½¿ç”¨é˜»å¡æ—¶ä¼šé˜»å¡å…¶ä»–çº¿ç¨‹<br><img src="/img/in-post/2021-06-02/img.png" alt="img.png"><br>æ··åˆæ¨¡å¼è§£å†³äº†å¤šå¯¹å¤šå’Œ1å¯¹1æ¨¡å‹è§£å†³äº†çº¿ç¨‹æ²¡åŠæ³•ä½¿ç”¨é˜»å¡é—®é¢˜ï¼Œä½†æ˜¯1å¯¹1æ¨¡å‹ä¼šå ç”¨å¤šä¸ªå†…æ ¸çº¿ç¨‹ï¼Œå¯¹æ“ä½œç³»ç»Ÿå†…æ ¸åˆ‡æ¢å½±å“æ¯”è¾ƒå¤§ï¼Œç¬¬ä¸‰ç§å¤šå¯¹å¤šæ¨¡å‹æ˜¯å¹¶å‘æ•ˆæœæœ€å¥½çš„</p><h3 id="è¿›ç¨‹é—´é€šä¿¡"><a href="#è¿›ç¨‹é—´é€šä¿¡" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡"></a>è¿›ç¨‹é—´é€šä¿¡</h3><p>è¿›ç¨‹é€šå¸¸éœ€è¦ä¸å…¶ä»–è¿›ç¨‹é€šä¿¡ï¼Œä»¥è¾¾åˆ°ä¿¡æ¯ä¼ é€’å¹¶èƒ½ä¿è¯è¿›ç¨‹æŒ‰ç…§æ­£ç¡®é¡ºåºæ‰§è¡Œ</p><h4 id="ç«äº‰æ¡ä»¶"><a href="#ç«äº‰æ¡ä»¶" class="headerlink" title="ç«äº‰æ¡ä»¶"></a>ç«äº‰æ¡ä»¶</h4><p>å¤šä¸ªè¿›ç¨‹è¯»å†™æŸä¸ªå…±äº«æ•°æ®ï¼Œè€Œæœ€åçš„ç»“æœå–å†³äºè¿›ç¨‹è¿è¡Œçš„ç²¾å‡†æ—¶åºï¼Œç§°ä¸ºç«äº‰æ¡ä»¶</p><h4 id="ä¸´ç•ŒåŒº"><a href="#ä¸´ç•ŒåŒº" class="headerlink" title="ä¸´ç•ŒåŒº"></a>ä¸´ç•ŒåŒº</h4><p>æ€æ ·é¿å…ç«äº‰æ¡ä»¶ï¼Ÿä¸»è¦ç›®æ ‡æ˜¯ç»„ç»‡å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»å–å…±äº«æ•°æ®ï¼Œå³äº’æ–¥<br>æŠ½è±¡æè¿°å°±æ˜¯ï¼Œæˆ‘ä»¬æŠŠå…±äº«å†…å­˜è¿›è¡Œè®¿é—®çš„ç¨‹åºç‰‡æ®µå«åš<strong>ä¸´ç•Œèµ„æº</strong>æˆ–è€…<strong>ä¸´ç•ŒåŒº</strong>,æˆ‘ä»¬åªè¦ä¿è¯ä¸¤ä¸ªè¿›ç¨‹ä¸åŒæ—¶åœ¨ä¸´ç•ŒåŒºï¼Œå°±èƒ½é¿å…ç«äº‰</p><p>å°½ç®¡é¿å…ç«äº‰æ¡ä»¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¸èƒ½ä¿è¯æ•°æ®å…±äº«çš„å¹¶å‘è¿›ç¨‹èƒ½é«˜æ•ˆçš„æ‰§è¡Œï¼šå¯¹äºä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p><ul><li>ä»»ä½•ä¸¤ä¸ªè¿›ç¨‹ä¸èƒ½åŒæ—¶å¤„äºä¸´ç•ŒåŒº</li><li>ä¸åº”å¯¹cpuçš„æ•°é‡å’Œé€Ÿåº¦åšä»»ä½•å‡è®¾</li><li>ä¸´ç•ŒåŒºå¤–çš„è¿è¡Œè¿›ç¨‹ä¸å¾—é˜»å¡å…¶ä»–è¿›ç¨‹</li><li>ä¸å¾—ä½¿è¿›ç¨‹æ— é™æœŸç­‰å¾…è¿›å…¥ä¸´ç•ŒåŒº</li></ul><p><img src="/img/in-post/2021-06-02/img_1.png" alt="img_1.png"><br>å¯¹äºç†æƒ³çš„æ–¹æ¡ˆåº”è¯¥æ˜¯å¦‚ä¸Šå›¾è¿™æ ·çš„ï¼ŒæŸä¸€æ—¶åˆ»å¯¹ä¸ä¸´ç•ŒåŒºçš„è®¿é—®åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹</p><h4 id="äº’æ–¥æ–¹æ¡ˆ"><a href="#äº’æ–¥æ–¹æ¡ˆ" class="headerlink" title="äº’æ–¥æ–¹æ¡ˆ"></a>äº’æ–¥æ–¹æ¡ˆ</h4><h5 id="å±è”½ä¸­æ–­"><a href="#å±è”½ä¸­æ–­" class="headerlink" title="å±è”½ä¸­æ–­"></a>å±è”½ä¸­æ–­</h5><p>æœ€ç®€å•çš„å®ç°æ–¹æ¡ˆï¼Œå½“è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œç«‹å³å±è”½æ‰€æœ‰ä¸­æ–­ï¼Œåœ¨ç¦»å¼€ä¹‹å‰æ‰“å¼€ä¸­æ–­ï¼Œå±è”½ä¸­æ–­åï¼Œcpuæ—¶é’Ÿä¸­æ–­ä¹Ÿä¼šå±è”½ï¼Œcpuåªæœ‰åœ¨å‘ç”Ÿæ—¶é’Ÿä¸­æ–­æˆ–å…¶ä»–ä¸­æ–­æ—¶æ‰ä¼šåˆ‡æ¢è¿›ç¨‹ï¼Œè¿™æ ·ï¼Œå±è”½ä¸­æ–­åcpuä¸ä¼šåˆ‡æ¢è¿›ç¨‹ï¼Œä¸å¿…æ‹…å¿ƒå…¶ä»–è¿›ç¨‹çš„ä»‹å…¥</p><p>è¿™ä¸ªæ–¹æ¡ˆå¹¶ä¸å¥½ï¼Œå¯¹äºå•æ ¸cpuï¼Œæ‰§è¡Œå±è”½ä¸­æ–­å¦‚æœä¸åœ¨æ‰“å¼€ï¼Œç³»ç»Ÿä¼šå› æ­¤è€Œç»ˆæ­¢ï¼Œå¯¹äºå¤šæ ¸cpuï¼Œä»…å¯¹æ‰§è¡Œdisableçš„é‚£ä¸ªcpuä¼˜å…ˆï¼Œå…¶ä»–cpuä»ç»§ç»­æ‰§è¡Œ</p><h5 id="é”å˜é‡"><a href="#é”å˜é‡" class="headerlink" title="é”å˜é‡"></a>é”å˜é‡</h5><p>å®ç°æ–¹æ¡ˆä¸ºè®¾è®¡ä¸€ä¸ªé”å˜é‡ï¼Œå…¶å€¼ä¸º0ï¼Œå¦‚æœæœ‰å…¶ä»–ç¨‹åºè¿›å…¥åˆ°ä¸´ç•ŒåŒºï¼Œä¼šå°†å€¼èµ‹å€¼ä¸º1ï¼Œè¿™æ ·ï¼Œå…¶ä»–è¿›ç¨‹è¯»åˆ°1å°±ä¸ä¼šåœ¨è®¿é—®ä¸´ç•ŒåŒºäº†</p><p>è¿™ç§æ–¹æ¡ˆä¹Ÿä¼šå‡ºç°ç–å¿½ï¼Œå³ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œè¯»åˆ°çš„ä¸´ç•Œå˜é‡éƒ½æ˜¯0ï¼Œæ‰§è¡Œäº†ä¸¤æ¬¡èµ‹å€¼1çš„æ“ä½œï¼Œä½†è¿˜æ˜¯å‘ç”Ÿäº†èµ„æºç«äº‰</p><h5 id="ä¸¥æ ¼è½®æ¢æ³•"><a href="#ä¸¥æ ¼è½®æ¢æ³•" class="headerlink" title="ä¸¥æ ¼è½®æ¢æ³•"></a>ä¸¥æ ¼è½®æ¢æ³•</h5><p>è¿›ç¨‹a:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(turn != <span class="number">0</span>) &#123;&#125;</span><br><span class="line">    processstart()</span><br><span class="line">    turn = <span class="number">1</span></span><br><span class="line">    processend()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›ç¨‹b:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">while</span>(turn != <span class="number">1</span>) &#123;&#125;</span><br><span class="line">    processstart()</span><br><span class="line">    turn = <span class="number">0</span></span><br><span class="line">    processend()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹ï¼Œè¿›ç¨‹aå’Œbæ‹¿åˆ°çš„trunéƒ½æ˜¯0ï¼Œè¿™æ—¶ï¼Œåªæœ‰è¿›ç¨‹aèƒ½è¿›å…¥å¹¶ä¿®æ”¹turnä¸º1ï¼Œè¿™æ—¶è¿›ç¨‹bç”±äºturnä¸€ç›´ä¸º0ï¼Œä¼šä¸æ–­ç­‰å¾…ï¼Œç›´åˆ°turnå˜æˆ1ï¼Œè¿™ç§å¿™ç­‰å¾…è¡Œä¸ºè¢«ç§°ä¸º<strong>è‡ªæ—‹é”</strong></p><p>è¿™ç§æ–¹å¼å¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„æ‰§è¡Œé€Ÿåº¦ä¼šç›¸å·®å¾ˆå¤šï¼Œè½®æµè¿›å…¥æ—¶ä¼šæœ‰ä¸€æ–¹ç­‰å¾…å¾ˆé•¿æ—¶é—´ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„</p><h5 id="Personè§£æ³•"><a href="#Personè§£æ³•" class="headerlink" title="Personè§£æ³•"></a>Personè§£æ³•</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> FALSE 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TRUE  1</span></span><br><span class="line"><span class="comment">/* è¿›ç¨‹æ•°é‡ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N     2													</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* ç°åœ¨è½®åˆ°è° */</span></span><br><span class="line"><span class="type">int</span> turn;					</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ‰€æœ‰å€¼åˆå§‹åŒ–ä¸º 0 (FALSE) */</span></span><br><span class="line"><span class="type">int</span> interested[N];											</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è¿›ç¨‹æ˜¯ 0 æˆ– 1 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">enter_region</span><span class="params">(<span class="type">int</span> process)</span>&#123;					</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* å¦ä¸€ä¸ªè¿›ç¨‹å· */</span></span><br><span class="line">  <span class="type">int</span> other;														</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* å¦ä¸€ä¸ªè¿›ç¨‹ */</span></span><br><span class="line">  other = <span class="number">1</span> - process;				</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* è¡¨ç¤ºæ„¿æ„è¿›å…¥ä¸´ç•ŒåŒº */</span></span><br><span class="line">  interested[process] = TRUE;						</span><br><span class="line">  turn = process;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* ç©ºå¾ªç¯ */</span></span><br><span class="line">  <span class="keyword">while</span>(turn == process </span><br><span class="line">        &amp;&amp; interested[other] == <span class="literal">true</span>)&#123;&#125; </span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">leave_region</span><span class="params">(<span class="type">int</span> process)</span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* è¡¨ç¤ºç¦»å¼€ä¸´ç•ŒåŒº */</span></span><br><span class="line">  interested[process] == FALSE;				 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨å…±äº«å˜é‡æ—¶ï¼ˆå³è¿›å…¥å…¶ä¸´ç•ŒåŒºï¼‰ä¹‹å‰ï¼Œå„ä¸ªè¿›ç¨‹ä½¿ç”¨å„è‡ªçš„è¿›ç¨‹å· 0 æˆ– 1 ä½œä¸ºå‚æ•°æ¥è°ƒç”¨ enter_regionï¼Œè¿™ä¸ªå‡½æ•°è°ƒç”¨åœ¨éœ€è¦æ—¶å°†ä½¿è¿›ç¨‹ç­‰å¾…ï¼Œç›´åˆ°èƒ½å¤Ÿå®‰å…¨çš„ä¸´ç•ŒåŒºã€‚åœ¨å®Œæˆå¯¹å…±äº«å˜é‡çš„æ“ä½œä¹‹åï¼Œè¿›ç¨‹å°†è°ƒç”¨ leave_region è¡¨ç¤ºæ“ä½œå®Œæˆï¼Œå¹¶ä¸”å…è®¸å…¶ä»–è¿›ç¨‹è¿›å…¥ã€‚</p><p>ç°åœ¨æ¥çœ‹çœ‹è¿™ä¸ªåŠæ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä¸€å¼€å§‹ï¼Œæ²¡æœ‰ä»»ä½•è¿›ç¨‹å¤„äºä¸´ç•ŒåŒºä¸­ï¼Œç°åœ¨è¿›ç¨‹ 0 è°ƒç”¨ enter_regionã€‚å®ƒé€šè¿‡è®¾ç½®æ•°ç»„å…ƒç´ å’Œå°† turn ç½®ä¸º 0 æ¥è¡¨ç¤ºå®ƒå¸Œæœ›è¿›å…¥ä¸´ç•ŒåŒºã€‚ç”±äºè¿›ç¨‹ 1 å¹¶ä¸æƒ³è¿›å…¥ä¸´ç•ŒåŒºï¼Œæ‰€ä»¥ enter_region å¾ˆå¿«ä¾¿è¿”å›ã€‚å¦‚æœè¿›ç¨‹ç°åœ¨è°ƒç”¨ enter_regionï¼Œè¿›ç¨‹ 1 å°†åœ¨æ­¤å¤„æŒ‚èµ·ç›´åˆ° interested[0] å˜ä¸º FALSEï¼Œè¿™ç§æƒ…å†µåªæœ‰åœ¨è¿›ç¨‹ 0 è°ƒç”¨ leave_region é€€å‡ºä¸´ç•ŒåŒºæ—¶æ‰ä¼šå‘ç”Ÿã€‚</p><p>é‚£ä¹ˆä¸Šé¢è®¨è®ºçš„æ˜¯é¡ºåºè¿›å…¥çš„æƒ…å†µï¼Œç°åœ¨æ¥è€ƒè™‘ä¸€ç§ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è°ƒç”¨ enter_region çš„æƒ…å†µã€‚å®ƒä»¬éƒ½å°†è‡ªå·±çš„è¿›ç¨‹å­˜å…¥ turnï¼Œä½†åªæœ‰æœ€åä¿å­˜è¿›å»çš„è¿›ç¨‹å·æ‰æœ‰æ•ˆï¼Œå‰ä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹å·å› ä¸ºé‡å†™è€Œä¸¢å¤±ã€‚å‡å¦‚è¿›ç¨‹ 1 æ˜¯æœ€åå­˜å…¥çš„ï¼Œåˆ™ turn ä¸º 1 ã€‚å½“ä¸¤ä¸ªè¿›ç¨‹éƒ½è¿è¡Œåˆ° while çš„æ—¶å€™ï¼Œè¿›ç¨‹ 0 å°†ä¸ä¼šå¾ªç¯å¹¶è¿›å…¥ä¸´ç•ŒåŒºï¼Œè€Œè¿›ç¨‹ 1 å°†ä¼šæ— é™å¾ªç¯ä¸”ä¸ä¼šè¿›å…¥ä¸´ç•ŒåŒºï¼Œç›´åˆ°è¿›ç¨‹ 0 é€€å‡ºä½ç½®ã€‚</p><h5 id="TSLæŒ‡ä»¤"><a href="#TSLæŒ‡ä»¤" class="headerlink" title="TSLæŒ‡ä»¤"></a>TSLæŒ‡ä»¤</h5><p>TSLæŒ‡ä»¤æ˜¯ä¸€ä¸ªéœ€è¦ç¡¬ä»¶æ”¯æŒçš„æ–¹æ¡ˆã€‚TSLç§°ä¸ºæµ‹è¯•å¹¶åŠ é”ï¼ˆtest and set lockï¼‰ã€‚ä»–å°†ä¸€ä¸ªå†…å­˜å­—LOCKè¯»åˆ°å¯„å­˜å™¨RXä¸­ã€‚ç„¶ååœ¨è¯¥å†…å­˜åœ°å€ä¸Šå­˜ä¸€ä¸ªéé›¶å€¼ã€‚è¯»å­—å’Œå†™å­—æ“ä½œæ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œå³è¯¥æŒ‡ä»¤ç»“æŸå‰å…¶ä»–å¤„ç†å™¨å‡ä¸å…è®¸è®¿é—®è¯¥å†…å­˜å­—ã€‚æ‰§è¡ŒTSLæŒ‡ä»¤çš„CPUå°†é”ä½å†…å­˜ä¸­çº¿ï¼Œä»¥ç¦æ­¢å…¶ä»–CPUåœ¨æœ¬æŒ‡ä»¤ç»“æŸå‰è®¿é—®å†…å­˜ã€‚TSLæŒ‡ä»¤è§£å†³äº†å¿™ç­‰å¾…çš„å±è”½ä¸­æ–­æ–¹æ¡ˆä¸­æ— æ³•å±è”½å¤šå¤„ç†å™¨è®¿é—®å…±äº«å†…å­˜çš„é—®é¢˜ã€‚ å› ä¸ºé”ä½å†…å­˜æ€»çº¿ä¸åŒäºå±è”½ä¸­æ–­ï¼Œé”ä½å†…å­˜æ€»çº¿åï¼Œæ‰€æœ‰å¤„ç†å™¨éƒ½æ— æ³•é€šè¿‡å†…å­˜æ€»çº¿è®¿é—®å†…å­˜å­—ã€‚ é‚£äº›å¤šå¤„ç†å™¨çš„è®¡ç®—æœºéƒ½æœ‰TSLæŒ‡ä»¤ã€‚å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TSL RX, LOCK</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">enter_region:</span><br><span class="line">    TSL REGISTER, LOCK</span><br><span class="line">    CMP REGISTER, #0</span><br><span class="line">    JNE enter_region       ; å¦‚æœä¸ç©ºé—²(=0)ï¼Œé‚£ä¹ˆåå¤æ‰§è¡Œï¼Œå¤„äºå¿™ç­‰å¾…çŠ¶æ€</span><br><span class="line">    RET</span><br><span class="line"></span><br><span class="line">leave_region:</span><br><span class="line">    MOVE LOCK, #0</span><br><span class="line">    RET</span><br></pre></td></tr></table></figure><p>å…·ä½“å·¥ä½œè¿‡ç¨‹ï¼šç¬¬ä¸€æ¡æŒ‡ä»¤å°†lockåŸæ¥çš„å€¼å¤åˆ¶åˆ°å¯„å­˜å™¨ä¸­å¹¶å°†lockè®¾ç½®ä¸º1ï¼Œéšåè¿™ä¸ªåŸæ¥çš„å€¼ä¸0ç›¸æ¯”è¾ƒã€‚å¦‚æœåŸæ¥çš„å€¼éé›¶ï¼Œåˆ™è¯´æ˜ä»¥å‰å·²è¢«åŠ é”ï¼Œåˆ™ç¨‹åºå°†å›åˆ°å¼€å§‹å¹¶å†æ¬¡æµ‹è¯•ã€‚ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œlockå€¼å˜ä¸º0ï¼Œäºæ˜¯è¿‡ç¨‹è¿”å›ï¼Œæ­¤æ—¶å·²åŠ é”ã€‚è¦æ¸…é™¤è¿™ä¸ªé”æ¯”è¾ƒç®€å•ï¼Œç¨‹åºåªéœ€å°†0å­˜å…¥lockå³å¯ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„åŒæ­¥æŒ‡ä»¤ã€‚</p><p>ä¸€ä¸ªå¯æ›¿ä»£TSLçš„æŒ‡ä»¤æ˜¯XCHGï¼Œå®ƒåŸå­æ€§åœ°äº¤æ¢ä¸¤ä¸ªä½ç½®çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå¯„å­˜å™¨ä¸ä¸€ä¸ªå­˜å‚¨å­—ã€‚å®ƒæœ¬è´¨ä¸Šä¸TSLçš„è§£å†³åŠæ³•ä¸€æ ·ã€‚æ‰€æœ‰çš„Intel x86 CPUåœ¨åº•å±‚åŒæ­¥ä¸­ä½¿ç”¨XCHGæŒ‡ä»¤ã€‚</p><h5 id="ç¡çœ ä¸å”¤é†’"><a href="#ç¡çœ ä¸å”¤é†’" class="headerlink" title="ç¡çœ ä¸å”¤é†’"></a>ç¡çœ ä¸å”¤é†’</h5><p>ä¸Šè¿°åŸºäºå¿™ç­‰å¾…çš„äº’æ–¥ï¼Œä¸ä»…ä¼šæµªè´¹CPUæ—¶é—´ï¼Œè€Œä¸”è¿˜å¯èƒ½å¼•èµ·é¢„æƒ³ä¸åˆ°çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸¤ä¸ªè¿›ç¨‹Lå’ŒHï¼ŒLçš„ä¼˜å…ˆçº§è¾ƒä½ã€Hçš„ä¼˜å…ˆçº§è¾ƒé«˜ã€‚è°ƒåº¦è§„åˆ™è§„å®šï¼Œåªè¦Hå¤„äºå°±ç»ªæ€å®ƒå°±ä¼šè¿è¡Œã€‚åœ¨æŸä¸€æ—¶åˆ»ï¼ŒLå¤„äºä¸´ç•ŒåŒºä¸­ï¼Œæ­¤æ—¶Hå˜åˆ°å°±ç»ªæ€ï¼Œå‡†å¤‡è¿è¡Œã€‚ç°åœ¨Hå¼€å§‹å¿™ç­‰å¾…ï¼Œå¾…ç”±äºHå°±ç»ªæ—¶ï¼ŒLå°±ä¸ä¼šè¢«è°ƒåº¦ï¼Œä¹Ÿå°±æ— æ³•ç¦»å¼€ä¸´ç•ŒåŒºï¼Œæ‰€ä»¥Hå°†æ°¸è¿œå¿™ç­‰å¾…ä¸‹å»ã€‚è¿™ç§æƒ…å†µæœ‰æ—¶è¢«ç§°ä½œä¼˜å…ˆçº§åè½¬é—®é¢˜ã€‚</p><p>æœ€ç®€å•çš„è¿›ç¨‹é—´é€šä¿¡åŸè¯­ï¼Œå®ƒä»¬åœ¨æ— æ³•è¿›å…¥ä¸´ç•ŒåŒºæ—¶å°†é˜»å¡ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ã€‚ä¸¤æ¡æœ€ç®€å•çš„é€šä¿¡åŸè¯­æ˜¯ï¼šsleepå’Œwakeupã€‚sleepæ˜¯ä¸€ä¸ªå°†å¼•èµ·è°ƒç”¨è¿›ç¨‹é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå³è¢«æŒ‚èµ·ï¼Œç›´åˆ°å¦å¤–ä¸€ä¸ªè¿›ç¨‹å°†å…¶å”¤é†’ã€‚wakeupè°ƒç”¨æœ‰ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è¢«å”¤é†’çš„è¿›ç¨‹ã€‚</p><h5 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h5><p>åŸºäºæ”¯æŒPã€Væ“ä½œçš„éè´Ÿæ•´æ•°å®ç°ã€‚</p><p>ä¿¡å·é‡çš„ç”¨å¤„ä¸€ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</p><p>åœ¨ä½¿ç”¨ä¿¡å·é‡çš„ç³»ç»Ÿä¸­ï¼Œéšè—ä¸­æ–­çš„æœ€è‡ªç„¶çš„æ–¹æ³•å°±æ˜¯ä¸ºæ¯ä¸€ä¸ªI&#x2F;Oè®¾å¤‡è®¾ç½®ä¸€ä¸ªä¿¡å·é‡ï¼Œå…¶åˆå§‹å€¼ä¸º0ã€‚åœ¨å¯åŠ¨ä¸€ä¸ªI&#x2F;Oè®¾å¤‡ä¹‹åï¼Œç®¡ç†è¿›ç¨‹å°±ç«‹å³å¯¹ç›¸å…³è”çš„ä¿¡å·é‡æ‰§è¡Œä¸€ä¸ªDownæ“ä½œï¼Œäºæ˜¯è¿›ç¨‹ç«‹å³è¢«é˜»å¡ã€‚å½“ç»ˆç«¯åˆ°æ¥æ—¶ï¼Œç»ˆç«¯å¤„ç†ç¨‹åºéšå³å¯¹ç›¸å…³ä¿¡å·é‡æ‰§è¡Œä¸€ä¸ªUpæ“ä½œï¼Œä»è€Œå°†ç›¸å…³çš„è¿›ç¨‹è®¾ç½®ä¸ºå°±ç»ªçŠ¶æ€ã€‚</p><p>ä¸ºäº†è§£å†³ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä¸‰ä¸ªä¿¡å·é‡ï¼šfullï¼Œ ç”¨äºè®°å½•å……æ»¡çš„ç¼“å†²æ§½æ•°æ®ï¼›emptyï¼Œç”¨äºè®°å½•ç©ºçš„ç¼“å†²æ§½æ€»æ•°ï¼›mutexï¼Œç”¨æ¥ç¡®ä¿ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ä¼šåŒæ—¶è®¿é—®ç¼“å†²åŒºã€‚</p><p>ä¿¡å·é‡çš„ç”¨å¤„äºŒï¼šç”¨äºå®ç°åŒæ­¥(Synchronization)</p><p>ä¿¡å·é‡fullå’Œemptyç”¨æ¥ä¿è¯æŸç§æ—¶é—´çš„é¡ºåºå‘ç”Ÿæˆ–ä¸å‘ç”Ÿã€‚ä¾‹å¦‚ï¼Œå½“ç¼“å†²åŒºæ»¡çš„æ—¶å€™ç”Ÿäº§è€…åœæ­¢è¿è¡Œï¼Œè€Œç©ºçš„æ—¶å€™æ¶ˆè´¹è€…åœæ­¢è¿è¡Œã€‚</p><h5 id="äº’æ–¥é‡"><a href="#äº’æ–¥é‡" class="headerlink" title="äº’æ–¥é‡"></a>äº’æ–¥é‡</h5><p>äº’æ–¥é‡æ˜¯ä¸€ä¸ªå¯ä»¥å¤„äºä¸¤æ€ä¹‹ä¸€çš„å˜é‡ï¼šåŠ é”ã€è§£é”ã€‚ç›¸æ¯”äºä¿¡å·é‡ï¼Œå®ƒæ²¡æœ‰è®¡æ•°åŠŸèƒ½ã€‚</p><p>ç”±äºäº’æ–¥é‡éå¸¸ç®€å•ï¼Œæ‰€ä»¥å¦‚æœæœ‰TSLæˆ–XCHGæŒ‡ä»¤ï¼Œå°±å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®ç°å®ƒä»¬ã€‚ç”±äºç”¨æˆ·çº§çº¿ç¨‹åŒ…çš„mutex_lockå’Œmutex_unlockä»£ç ä¸‹(0è¡¨ç¤ºè§£é”)ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mutex_lock:</span><br><span class="line">    TSL REGISTER, MUTEX</span><br><span class="line">    CMP REGISTER, #<span class="number">0</span></span><br><span class="line">    JZE ok                   ; å¦‚æœäº’æ–¥é”ç©ºé—²ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ç»§ç»­è¿è¡Œ</span><br><span class="line">    CALL thread_yield        ; å¦‚æœäº’æ–¥é”å¿™ï¼Œé‚£ä¹ˆå°±è°ƒç”¨å…¶å®ƒè¿›ç¨‹ï¼Œè¿™æ˜¯ä¸å¿™ç­‰å¾…çš„åŒºåˆ«</span><br><span class="line">    JMP mutex_lock           ; ç¨åå†è¯•ï¼Œä¹Ÿå°±æ˜¯æœ¬ä»£ç æ®µçš„å¼€å¤´</span><br><span class="line">ok: RET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mutex_unlock:</span><br><span class="line">    MOVE MUTEX, #<span class="number">0</span></span><br><span class="line">    RET</span><br></pre></td></tr></table></figure><p>mutex_lockçš„ä»£ç ä¸enter_regionçš„ä»£ç å¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«ã€‚å½“enter_regionè¿›å…¥ä¸´ç•ŒåŒºå¤±è´¥åï¼Œå®ƒå§‹ç»ˆé‡å¤æµ‹è¯•é”(å¿™ç­‰å¾…)ã€‚å®é™…ä¸Šï¼Œç”±äºæ—¶é’Ÿè¶…æ—¶çš„ä½œç”¨ï¼Œä¼šè°ƒåº¦å…¶å®ƒè¿›ç¨‹è¿è¡Œï¼Œè¿™æ ·è¿Ÿæ—©æ‹¥æœ‰é”çš„è¿›ç¨‹ä¼šè¿›å…¥è¿è¡Œå¹¶é‡Šæ”¾é”ã€‚</p><p>åœ¨ç”¨æˆ·çº¿ç¨‹ä¸­ï¼Œæƒ…å½¢æœ‰æ‰€ä¸åŒï¼Œå› ä¸ºæ²¡æœ‰æ—¶é’Ÿåœæ­¢è¿è¡Œæ—¶é—´é•¿åº¦çš„çº¿ç¨‹ã€‚ç»“æœå°±æ˜¯é€šè¿‡å¿™ç­‰å¾…çš„æ–¹å¼æ¥è¯•å›¾è·å–é”çš„çº¿ç¨‹å°†æ°¸è¿œå¾ªç¯ä¸‹å»ï¼Œç»ä¸ä¼šå¾—åˆ°é”ï¼Œå› ä¸ºè¿™ä¸ªè¿è¡Œçš„çº¿ç¨‹ä¸ä¼šè®©å…¶å®ƒçº¿ç¨‹è¿è¡Œä»è€Œé‡Šæ”¾é”ã€‚</p><p>è¿™å°±æ˜¯enter_regionä¸mutex_lockçš„åŒºåˆ«</p><h5 id="Pthreadä¸­çš„äº’æ–¥é”"><a href="#Pthreadä¸­çš„äº’æ–¥é”" class="headerlink" title="Pthreadä¸­çš„äº’æ–¥é”"></a>Pthreadä¸­çš„äº’æ–¥é”</h5><p>pthreadä¸­æä¾›äº†åŸºäºäº’æ–¥é”çš„åŒæ­¥æœºåˆ¶ã€‚æä¾›çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pthread_mutex_init();      // åˆ›å»ºäº’æ–¥é”</span><br><span class="line">pthread_mutex_destroy();   // é”€æ¯äº’æ–¥é”</span><br><span class="line">pthread_mutex_lock();      // ä¸Šé”</span><br><span class="line">pthread_mutex_trylock();   // å°è¯•ä¸Šé”ï¼Œè‹¥ä¸Šé”ä¸æˆåŠŸï¼Œä¼šè¿”å›é”™è¯¯ä»£ç è€Œä¸æ˜¯é˜»å¡è°ƒç”¨è€…</span><br><span class="line">pthread_mutex_unlock();    // å¯¹äº’æ–¥é”è§£é”</span><br></pre></td></tr></table></figure><p>pthreadä¸­å¤„ç†æä¾›äº†äº’æ–¥é”ï¼Œè¿˜æä¾›äº†æ¡ä»¶å˜é‡ç”¨äºå®ç°åŒæ­¥ã€‚äº’æ–¥é‡åœ¨å…è®¸æˆ–é˜»å¡å¯¹ä¸´ç•ŒåŒºçš„è®¿é—®ä¸Šæ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ¡ä»¶å˜é‡åˆ™å…è®¸çº¿ç¨‹ç”±äºä¸€äº›æœªè¾¾åˆ°çš„æ¡ä»¶è€Œé˜»å¡ã€‚ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§æ–¹æ³•æ˜¯ä¸€èµ·ä½¿ç”¨çš„ã€‚ä¸‹é¢å°±æ˜¯çº¿ç¨‹ã€äº’æ–¥é‡ã€æ¡ä»¶å˜é‡ä¹‹é—´çš„å…³è”ã€‚</p><h4 id="ç®¡ç¨‹"><a href="#ç®¡ç¨‹" class="headerlink" title="ç®¡ç¨‹"></a>ç®¡ç¨‹</h4><h5 id="ä¸ºä»€ä¹ˆå¼•å…¥ç®¡ç¨‹"><a href="#ä¸ºä»€ä¹ˆå¼•å…¥ç®¡ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆå¼•å…¥ç®¡ç¨‹"></a>ä¸ºä»€ä¹ˆå¼•å…¥ç®¡ç¨‹</h5><p>ä¿¡å·é‡æœºåˆ¶å­˜åœ¨çš„é—®é¢˜ï¼šç¼–å†™ç¨‹åºå›°éš¾ã€æ˜“å‡ºé”™</p><p>èƒ½ä¸èƒ½è®¾è®¡ä¸€ç§æœºåˆ¶ï¼Œè®©ç¨‹åºå‘˜å†™ç¨‹åºæ—¶ä¸éœ€è¦å†å…³æ³¨å¤æ‚çš„PVæ“ä½œï¼Œè®©å†™ä»£ç æ›´è½»æ¾å‘¢?</p><p>1973å¹´ï¼ŒBrinch Hansené¦–æ¬¡åœ¨ç¨‹åºè®¾è®¡è¯­è¨€(Pascal) ä¸­å¼•å…¥äº†â€œç®¡ç¨‹â€æˆåˆ†â€•â€•ä¸€ç§é«˜çº§åŒæ­¥æœºåˆ¶</p><h5 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h5><p>ç®¡ç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„è½¯ä»¶æ¨¡å—ï¼Œæœ‰è¿™äº›éƒ¨åˆ†ç»„æˆ:</p><ul><li><p>å±€éƒ¨äºç®¡ç¨‹çš„å…±äº«æ•°æ®ç»“æ„è¯´æ˜;</p></li><li><p>å¯¹è¯¥æ•°æ®ç»“æ„è¿›è¡Œæ“ä½œçš„ä¸€ç»„è¿‡ç¨‹;</p></li><li><p>å¯¹å±€éƒ¨äºç®¡ç¨‹çš„å…±äº«æ•°æ®è®¾ç½®åˆå§‹å€¼çš„è¯­å¥;</p></li><li><p>ç®¡ç¨‹æœ‰ä¸€ä¸ªåå­—ã€‚</p></li></ul><h5 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h5><p>ç®¡ç¨‹çš„åŸºæœ¬ç‰¹å¾:</p><ul><li><p>å±€éƒ¨äºç®¡ç¨‹çš„æ•°æ®åªèƒ½è¢«å±€éƒ¨äºç®¡ç¨‹çš„è¿‡ç¨‹æ‰€è®¿é—®;</p></li><li><p>ä¸€ä¸ªè¿›ç¨‹åªæœ‰é€šè¿‡è°ƒç”¨ç®¡ç¨‹å†…çš„è¿‡ç¨‹ï¼ˆå‡½æ•°ï¼‰æ‰èƒ½è¿›å…¥ç®¡ç¨‹è®¿é—®å…±äº«æ•°æ®;</p></li><li><p>æ¯æ¬¡ä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹åœ¨ç®¡ç¨‹å†…æ‰§è¡ŒæŸä¸ªå†…éƒ¨è¿‡ç¨‹ã€‚</p></li></ul><p>å‚è€ƒæ–‡çŒ®:ç°ä»£æ“ä½œç³»ç»Ÿ(ç¬¬å››ç‰ˆ)</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2021/03/06/2021-03-06-docker-swarm/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2021/03/06/2021-03-06-docker-swarm/" class="post-title-link" itemprop="url">Docker Swarm</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-06 13:30:00" itemprop="dateCreated datePublished" datetime="2021-03-06T13:30:00+08:00">2021-03-06</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p><img src="/img/in-post/2019-03-06/5.png" alt="avatar"></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ä¸»èŠ‚ç‚¹ï¼š192.168.205.10<br>ä»èŠ‚ç‚¹1ï¼š192.168.205.11<br>ä»èŠ‚ç‚¹2ï¼š192.168.205.12</p><p><img src="/img/in-post/2019-03-06/1.png" alt="avatar"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --advertise-addr 192.168.205.10</span><br></pre></td></tr></table></figure><p>å¤åˆ¶æç¤ºçš„å‘½ä»¤åˆ°å…¶å®ƒä¸¤ä¸ªå®¹å™¨ä¸­æ‰§è¡Œ</p><p><img src="/img/in-post/2019-03-06/2.png" alt="avatar"><br><img src="/img/in-post/2019-03-06/3.png" alt="avatar"></p><p>æŸ¥çœ‹nodeä¿¡æ¯</p><p><img src="/img/in-post/2019-03-06/4.png" alt="avatar"></p><h2 id="service-åˆ›å»ºå’Œæ°´å¹³æ‰©å±•"><a href="#service-åˆ›å»ºå’Œæ°´å¹³æ‰©å±•" class="headerlink" title="service åˆ›å»ºå’Œæ°´å¹³æ‰©å±•"></a>service åˆ›å»ºå’Œæ°´å¹³æ‰©å±•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">docker service COMMAND</span><br><span class="line"></span><br><span class="line">Manage services</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a new service</span><br><span class="line">  inspect     Display detailed information on one or more services</span><br><span class="line">  logs        Fetch the logs of a service or task</span><br><span class="line">  <span class="built_in">ls</span>          List services</span><br><span class="line">  ps          List the tasks of one or more services</span><br><span class="line">  <span class="built_in">rm</span>          Remove one or more services</span><br><span class="line">  rollback    Revert changes to a service<span class="string">&#x27;s configuration</span></span><br><span class="line"><span class="string">  scale       Scale one or multiple replicated services</span></span><br><span class="line"><span class="string">  update      Update a service</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Run &#x27;</span>docker service COMMAND --<span class="built_in">help</span><span class="string">&#x27; for more information on a command</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name demo busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker service <span class="built_in">ls</span>       </span><br><span class="line">docker service ps demo  //æŸ¥çœ‹serviceå­˜æ”¾åœ¨å“ªå°æœºå™¨</span><br><span class="line">docker ps   //æŸ¥çœ‹å½“å‰æœºå™¨ä¸‹çš„service</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-06/Snip20190306_6.png" alt="avatar"></p><p>replicatedè¡¨æ˜å¯ä»¥æ¨ªå‘æ‰©å±•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service scale demo=5</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-06/Snip20190306_7.png" alt="avatar"></p><p>5&#x2F;5è¡¨ç¤º5ä¸ªéƒ½å·²ç»ready&#x2F;å…±5ä¸ªscale</p><p>swarm åˆ†å¸ƒæƒ…å†µ<br><img src="/img/in-post/2019-03-06/Snip20190306_1.png" alt="avatar"><br><img src="/img/in-post/2019-03-06/Snip20190306_2.png" alt="avatar"></p><p>åˆ é™¤swarm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service <span class="built_in">rm</span> demo</span><br></pre></td></tr></table></figure><h2 id="åœ¨docker-swarmä¸‹éƒ¨ç½²wordpress"><a href="#åœ¨docker-swarmä¸‹éƒ¨ç½²wordpress" class="headerlink" title="åœ¨docker swarmä¸‹éƒ¨ç½²wordpress"></a>åœ¨docker swarmä¸‹éƒ¨ç½²wordpress</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//åˆ›å»ºoverlayç½‘ç»œ</span><br><span class="line">[vagrant@swarm-manager ~]$ docker network create -d overlay demo</span><br><span class="line">lqem7ybsxvsqupsamhs7gwuym</span><br><span class="line">[vagrant@swarm-manager ~]$ docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">81117831f35e        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">lqem7ybsxvsq        demo                overlay             swarm</span><br><span class="line">f5cf7cd988bf        docker_gwbridge     bridge              <span class="built_in">local</span></span><br><span class="line">6fca47e6833e        host                host                <span class="built_in">local</span></span><br><span class="line">qn8r5p813ae9        ingress             overlay             swarm</span><br><span class="line">5d8be2887f8b        none                null                <span class="built_in">local</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºmysql service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name mysql --<span class="built_in">env</span> MYSQL_ROOT_PASSWORD=root --<span class="built_in">env</span> MYSQL_DATABASE=wordpress --network demo --mount <span class="built_in">type</span>=volume,<span class="built_in">source</span>=mysql-data,destination=/var/lib/mysql mysql:5.7</span><br></pre></td></tr></table></figure><p>åˆ›å»ºwordpress service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service create --name wordpress -p 80:80 --<span class="built_in">env</span> WORDPRESS_DB_PASSWORD=root --<span class="built_in">env</span> WORDPRESS_DB_HOST=mysql --network demo wordpress</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²æˆåŠŸ<br><img src="/img/in-post/2019-03-06/Snip20190307_2.png" alt="avatar"></p><p>æ­¤æ—¶è®¿é—®é›†ç¾¤ä¸­ä»»æ„ä¸€å°æœºå™¨çš„ipéƒ½å¯ä»¥è®¿é—®åˆ°wordpressï¼Œå®é™…ä¸Š,dockeråœ¨swarmä¸­å»ºç«‹äº†ä¸€ä¸ªè™šæ‹Ÿipæ¥å®ç°é€šä¿¡ï¼Œå…³äºé€šä¿¡æ–¹å¼å¯å‚è€ƒ<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bfb2c125d2bf">routingmesh</a></p><h2 id="Routing-Meshçš„ä¸¤ç§ä½“ç°"><a href="#Routing-Meshçš„ä¸¤ç§ä½“ç°" class="headerlink" title="Routing Meshçš„ä¸¤ç§ä½“ç°"></a>Routing Meshçš„ä¸¤ç§ä½“ç°</h2><ol><li>internal:Containerä¸Containerä¹‹é—´è®¿é—®é€šè¿‡overlayç½‘ç»œ(è™šæ‹Ÿip)</li><li>ingress: å¦‚æœæœåŠ¡æœ‰ç»‘å®šæ¥å£ï¼Œæ­¤æœåŠ¡å¯é€šè¿‡swarmä¸­ä»»æ„èŠ‚ç‚¹è®¿é—®</li></ol><h2 id="ingress-è´Ÿè½½å‡è¡¡"><a href="#ingress-è´Ÿè½½å‡è¡¡" class="headerlink" title="ingress è´Ÿè½½å‡è¡¡"></a>ingress è´Ÿè½½å‡è¡¡</h2><p>ä½œç”¨ï¼š</p><ol><li>å¤–éƒ¨è®¿é—®çš„è´Ÿè½½å‡è¡¡</li><li>æœåŠ¡ç«¯å£è¢«æš´æ¼ç»™å„ä¸ªswarmèŠ‚ç‚¹</li><li>å†…éƒ¨é€šè¿‡ipvsè¿›è¡Œè´Ÿè½½å‡è¡¡</li></ol><h2 id="docker-stack"><a href="#docker-stack" class="headerlink" title="docker stack"></a>docker stack</h2><h3 id="docker-compose-è¯­æ³•æ¢³ç†"><a href="#docker-compose-è¯­æ³•æ¢³ç†" class="headerlink" title="docker-compose è¯­æ³•æ¢³ç†"></a>docker-compose è¯­æ³•æ¢³ç†</h3><h4 id="ENDPOINT-MODE"><a href="#ENDPOINT-MODE" class="headerlink" title="ENDPOINT_MODE"></a>ENDPOINT_MODE</h4><p>ENDPOINT_MODE: vip | dnsrr</p><p>vip é€šè¿‡lvsè´Ÿè½½å‡è¡¡è™šæ‹Ÿipçš„æ–¹å¼ï¼ˆé»˜è®¤æ¨èä½¿ç”¨ï¼‰<br>dnsrrï¼šdnsè´Ÿè½½å‡è¡¡è½®è¯¢ç­–ç•¥</p><h4 id="LABELS"><a href="#LABELS" class="headerlink" title="LABELS"></a>LABELS</h4><p>lablesæ˜¯èµ·åˆ°å¸®åŠ©ä¿¡æ¯çš„ä½œç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: web</span><br><span class="line">    deploy:</span><br><span class="line">      labels:</span><br><span class="line">        com.example.description: <span class="string">&quot;This label will appear on the web service&quot;</span></span><br></pre></td></tr></table></figure><h4 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h4><p>mode: global | replicated(é»˜è®¤)</p><p>replicatedå¯ä»¥åšæ¨ªå‘æ‰©å±•ï¼Œglobalä¸å¯ä»¥</p><h4 id="PLACEMENT"><a href="#PLACEMENT" class="headerlink" title="PLACEMENT"></a>PLACEMENT</h4><p>node.role &#x3D;&#x3D; manager æŒ‡å®šéƒ¨ç½²åœ¨swarm managerèŠ‚ç‚¹ä¸Š<br>constraints ä¸€äº›é™åˆ¶æ¡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: postgres</span><br><span class="line">    deploy:</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.role == manager            </span><br><span class="line">          - engine.labels.operatingsystem == ubuntu 14.04</span><br><span class="line">        preferences:</span><br><span class="line">          - spread: node.labels.zone</span><br></pre></td></tr></table></figure><h4 id="REPLICAS"><a href="#REPLICAS" class="headerlink" title="REPLICAS"></a>REPLICAS</h4><p>åœ¨modeï¼šreplicatedä¸‹æœ‰æ•ˆ<br>replicas: 6 éƒ¨ç½²6ä¸ªservice</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  worker:</span><br><span class="line">    image: dockersamples/examplevotingapp_worker</span><br><span class="line">    networks:</span><br><span class="line">      - frontend</span><br><span class="line">      - backend</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 6</span><br></pre></td></tr></table></figure><h4 id="RESOURCES"><a href="#RESOURCES" class="headerlink" title="RESOURCES"></a>RESOURCES</h4><p>(cpu_shares, cpu_quota, cpuset, mem_limit, memswap_limit, mem_swappiness)çš„ä¸€äº›èµ„æºè®¾ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: <span class="string">&#x27;0.50&#x27;</span></span><br><span class="line">          memory: 50M</span><br><span class="line">        reservations:</span><br><span class="line">          cpus: <span class="string">&#x27;0.25&#x27;</span></span><br><span class="line">          memory: 20M</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºredisæœåŠ¡è¢«é™åˆ¶ä½¿ç”¨ä¸è¶…è¿‡50Mçš„å†…å­˜å’Œ0.50(50%)çš„å¯ç”¨å¤„ç†æ—¶é—´(CPU)ï¼Œå¹¶ä¿ç•™20Mçš„å†…å­˜å’Œ0.25 CPUæ—¶é—´(å§‹ç»ˆå¯ç”¨)</p><h4 id="RESTART-POLICY"><a href="#RESTART-POLICY" class="headerlink" title="RESTART_POLICY"></a>RESTART_POLICY</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&quot;3&quot;</span></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    deploy:</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">        delay: 5s</span><br><span class="line">        max_attempts: 3</span><br><span class="line">        window: 120s</span><br></pre></td></tr></table></figure><p>è¡¨ç¤ºæœåŠ¡åœæ­¢æ—¶æœ€å¤§å°è¯•æ¬¡æ•°ä¸º3,é‡å¯æ—¶é—´é—´éš”æ˜¯5ç§’ï¼Œé‡å¯æ˜¯å¦æˆåŠŸä¹‹å‰éœ€è¦ç­‰å¾…120sæ—¶é—´</p><h4 id="ROLLBACK-CONFIG"><a href="#ROLLBACK-CONFIG" class="headerlink" title="ROLLBACK_CONFIG"></a>ROLLBACK_CONFIG</h4><p>parallelismï¼šæœ€å¤šå¯ä»¥åŒæ—¶update2ä¸ªreplicasï¼Œæ¯æ¬¡åªèƒ½æ›´æ–°ä¸€ä¸ª<br>delayï¼šæ¯æ¬¡æ›´æ–°ä¹‹é—´çš„é—´éš”æ—¶é—´ï¼Œ<br>order: æ›´æ–°æœŸé—´çš„æ“ä½œé¡ºåºã€‚stop-first(æ—§ä»»åŠ¡åœ¨å¯åŠ¨æ–°ä»»åŠ¡ä¹‹å‰åœæ­¢)æˆ–start-first(æ–°ä»»åŠ¡é¦–å…ˆå¯åŠ¨ï¼Œæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡çŸ­æš‚æç½®)(é»˜è®¤stop-first)æ³¨æ„:åªæ”¯æŒv3.4æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3.4&#x27;</span></span><br><span class="line">services:</span><br><span class="line">  vote:</span><br><span class="line">    image: dockersamples/examplevotingapp_vote:before</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 2</span><br><span class="line">      update_config:</span><br><span class="line">        parallelism: 2</span><br><span class="line">        delay: 10s</span><br><span class="line">        order: stop-first</span><br></pre></td></tr></table></figure><p>è¯¦æƒ…å‚è€ƒ<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">compose-file</a></p><h3 id="é€šè¿‡docker-stack-éƒ¨ç½²wordpress"><a href="#é€šè¿‡docker-stack-éƒ¨ç½²wordpress" class="headerlink" title="é€šè¿‡docker stack éƒ¨ç½²wordpress"></a>é€šè¿‡docker stack éƒ¨ç½²wordpress</h3><p>sudo mkdir -p &#x2F;usr&#x2F;docker-vol&#x2F;mysql&#x2F;data</p><p>vim docker-compose.yml</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line"></span><br><span class="line">  web:</span><br><span class="line">    image: wordpress</span><br><span class="line">    ports:</span><br><span class="line">      - 8080:80</span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: mysql</span><br><span class="line">      WORDPRESS_DB_PASSWORD: root</span><br><span class="line">    networks:</span><br><span class="line">      - my-network</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 3</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">        delay: 5s</span><br><span class="line">        max_attempts: 3</span><br><span class="line">      update_config:</span><br><span class="line">        parallelism: 1</span><br><span class="line">        delay: 10s</span><br><span class="line"></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: root</span><br><span class="line">      MYSQL_DATABASE: wordpress</span><br><span class="line">    volumes:</span><br><span class="line">      - /usr/docker-vol/mysql/data:/var/lib/mysql</span><br><span class="line">    networks:</span><br><span class="line">      - my-network</span><br><span class="line">    deploy:</span><br><span class="line">      mode: global</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: <span class="string">&quot;0.2&quot;</span></span><br><span class="line">          memory: 512M</span><br><span class="line">      placement:</span><br><span class="line">        constraints:</span><br><span class="line">          - node.role == manager</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mysql-data:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  my-network:</span><br><span class="line">    driver: overlay</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy wordpress --compose-file=docker-compose.yml</span><br></pre></td></tr></table></figure><p>docker stack services wordpress æŸ¥çœ‹serviceå‡†å¤‡æƒ…å†µ</p><p>docker stack ls åˆ—ä¸¾stack</p><p>docker stack ps wordpress æŸ¥çœ‹wordpressè¿è¡Œæƒ…å†µ</p><p><img src="/img/in-post/2019-03-08/Snip20190308_5.png" alt="avatar"></p><p>çœ‹åˆ°å¦‚ä¸‹ç•Œé¢é…ç½®æˆåŠŸ</p><p><img src="/img/in-post/2019-03-08/Snip20190308_6.png" alt="avatar"></p><p>æ¸…ç©ºç¯å¢ƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stack <span class="built_in">rm</span> wordpress</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2021/03/04/2021-03-04-docker-volume/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2021/03/04/2021-03-04-docker-volume/" class="post-title-link" itemprop="url">Docker Volume</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-04 13:30:00" itemprop="dateCreated datePublished" datetime="2021-03-04T13:30:00+08:00">2021-03-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker volume <span class="built_in">ls</span>                // åˆ—å‡ºæ‰€æœ‰volume</span><br><span class="line">docker volume <span class="built_in">rm</span> &lt;VOLUME...&gt;    // åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªvolume</span><br><span class="line">docker volume <span class="built_in">rm</span> $(docker volume <span class="built_in">ls</span> -qf dangling=<span class="literal">true</span>) //åˆ é™¤å¤±æ•ˆçš„volume:</span><br></pre></td></tr></table></figure><h2 id="Data-Volume"><a href="#Data-Volume" class="headerlink" title="Data Volume"></a>Data Volume</h2><p>volumeæ˜¯dockeræ•°æ®æŒä¹…åŒ–çš„ä¸€ç§æ–¹å¼ï¼Œé‚£ä¹ˆæ€æ ·ä½¿ç”¨volumeå‘¢ï¼Ÿ</p><h3 id="Dockerfileä½¿ç”¨"><a href="#Dockerfileä½¿ç”¨" class="headerlink" title="Dockerfileä½¿ç”¨"></a>Dockerfileä½¿ç”¨</h3><p><img src="/img/in-post/2019-03-04/2.png"></p><p>å¯ä»¥é€šè¿‡mysqlå®˜æ–¹çš„Dockerfileçœ‹åˆ°volumeçš„ä½¿ç”¨æ–¹å¼</p><h3 id="å‘½ä»¤æ¨¡å¼ä½¿ç”¨"><a href="#å‘½ä»¤æ¨¡å¼ä½¿ç”¨" class="headerlink" title="å‘½ä»¤æ¨¡å¼ä½¿ç”¨"></a>å‘½ä»¤æ¨¡å¼ä½¿ç”¨</h3><p>å¯åŠ¨ä¸€å°mysql;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span> mysql</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹volume:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pengshiliang@pengshiliang-virtual-machine:~$ docker volume <span class="built_in">ls</span></span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>               195d16514c70f7990f190b1557fb2131a2b8942c48ef50025b7f08fc7b082dcd</span><br><span class="line">pengshiliang@pengshiliang-virtual-machine:~$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                 NAMES</span><br><span class="line">20752e526d9e        mysql               <span class="string">&quot;docker-entrypoint.sâ€¦&quot;</span>   14 seconds ago      Up 13 seconds       3306/tcp, 33060/tcp   mysql1</span><br><span class="line">pengshiliang@pengshiliang-virtual-machine:~$ docker volume inspect 195d16514c70f7990f190b1557fb2131a2b8942c48ef50025b7f08fc7b082dcd</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2019-03-04T21:41:29+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/195d16514c70f7990f190b1557fb2131a2b8942c48ef50025b7f08fc7b082dcd/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;195d16514c70f7990f190b1557fb2131a2b8942c48ef50025b7f08fc7b082dcd&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">pengshiliang@pengshiliang-virtual-machine:~$</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡inspectå‘½ä»¤æŸ¥çœ‹volumeçš„å­˜å‚¨è·¯å¾„</p><p>åˆ æ‰mysql container</p><p><img src="/img/in-post/2019-03-04/1.png"></p><p>å‘ç°volumeä»ç„¶å­˜åœ¨ï¼Œä¹Ÿç¡®è®¤äº†dockerå¯ä»¥é€šè¿‡volumeæŒä¹…åŒ–å­˜å‚¨æ•°æ®</p><p>è¿˜å¯ä»¥é€šè¿‡ä¸‹é¢çš„å®ä¾‹æ¥è¯å®</p><p>ä¸ºäº†é¿å…ç¯å¢ƒå½±å“,åˆ æ‰åˆšæ‰äº§ç”Ÿçš„volumeï¼Œé‡æ–°å¯åŠ¨ä¸€å°mysql</p><p><img src="/img/in-post/2019-03-04/3.png"></p><p>valumeçš„åç§°å¤ªé•¿äº†,åŠ å…¥ä¸€ä¸ª-vå‚æ•°ï¼Œæ¥ç»™volumeèµ·ä¸ªåˆ«å,ç„¶åå¯åŠ¨mysql,å¹¶æŒ‡å®švolumeå­˜æ”¾ä½ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v mysql:/var/lib/mysql --name mysql1 -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span> mysql</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-04/4.png"></p><p>è¿›å…¥å½“å‰containerï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ•°æ®åº“</p><p><img src="/img/in-post/2019-03-04/5.png"></p><p>ç„¶åé€€å‡ºï¼ŒæŠŠå½“å‰çš„mysql1å®¹å™¨åˆ æ‰</p><p><img src="/img/in-post/2019-03-04/6.png"></p><p>æ£€æŸ¥volume</p><p><img src="/img/in-post/2019-03-04/7.png"></p><p>å†å»å¯åŠ¨ä¸€å°mysql2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v mysql:/var/lib/mysql --name mysql2 -e MYSQL_ALLOW_EMPTY_PASSWORD=<span class="literal">true</span> mysql</span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ°å½“å‰å®¹å™¨çš„mysqlæ•°æ®åº“æŸ¥çœ‹è¯¦æƒ…</p><p><img src="/img/in-post/2019-03-04/8.png"></p><p>å‘ç°åˆšæ‰åˆ›å»ºçš„æ•°æ®åº“è¿˜åœ¨,ä¹Ÿè¯æ˜äº†volumeæ˜¯æŒä¹…åŒ–å­˜å‚¨çš„æ–¹å¼</p><h2 id="bind-mouting"><a href="#bind-mouting" class="headerlink" title="bind mouting"></a>bind mouting</h2><p>å‘½ä»¤:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -run -v /home/aaa:/root/aaa</span><br></pre></td></tr></table></figure><p>é€šè¿‡docker bind moutingå°†æœ¬åœ°å’ŒæœåŠ¡å™¨(å®¹å™¨)ä¸Šçš„èµ„æºç»‘å®šï¼Œæ”¹å˜ä¸€æ–¹éƒ½å¯¹æ•°æ®åŒæ­¥ï¼Œä»è€Œè¾¾åˆ°ç›´æ¥ä¿®æ”¹æœ¬åœ°èµ„æºï¼ŒæœåŠ¡å™¨ä¸Šçš„èµ„æºè‡ªåŠ¨æ›´æ–°</p><p>å‡†å¤‡ä¸€ä¸ªç›®å½•ï¼Œåˆ›å»ºindex.htmlæ–‡ä»¶</p><p><img src="/img/in-post/2019-03-04/9.png"></p><p><img src="/img/in-post/2019-03-04/10.png"></p><p>å¯ä»¥å‘ç°ï¼Œå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ˜¯å’Œcontainerå†…éƒ¨çš„&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;htmlæ–‡ä»¶æ˜¯åŒæ­¥çš„</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2021/03/04/2021-03-05-docker-compose/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2021/03/04/2021-03-05-docker-compose/" class="post-title-link" itemprop="url">Docker Compose</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-04 13:30:00" itemprop="dateCreated datePublished" datetime="2021-03-04T13:30:00+08:00">2021-03-04</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/1.23.2/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d nginx                     æ„å»ºå»ºå¯åŠ¨nignxå®¹å™¨</span><br><span class="line"></span><br><span class="line">docker-compose <span class="built_in">exec</span> nginx bash            ç™»å½•åˆ°nginxå®¹å™¨ä¸­</span><br><span class="line"></span><br><span class="line">docker-compose down                              åˆ é™¤æ‰€æœ‰nginxå®¹å™¨,é•œåƒ</span><br><span class="line"></span><br><span class="line">docker-compose ps                                   æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨</span><br><span class="line"></span><br><span class="line">docker-compose restart nginx                   é‡æ–°å¯åŠ¨nginxå®¹å™¨</span><br><span class="line"></span><br><span class="line">docker-compose run --no-deps --<span class="built_in">rm</span> php-fpm php -v  åœ¨php-fpmä¸­ä¸å¯åŠ¨å…³è”å®¹å™¨ï¼Œå¹¶å®¹å™¨æ‰§è¡Œphp -v æ‰§è¡Œå®Œæˆååˆ é™¤å®¹å™¨</span><br><span class="line"></span><br><span class="line">docker-compose build nginx                     æ„å»ºé•œåƒ ã€‚        </span><br><span class="line"></span><br><span class="line">docker-compose build --no-cache nginx   ä¸å¸¦ç¼“å­˜çš„æ„å»ºã€‚</span><br><span class="line"></span><br><span class="line">docker-compose logs  nginx                     æŸ¥çœ‹nginxçš„æ—¥å¿— </span><br><span class="line"></span><br><span class="line">docker-compose logs -f nginx                   æŸ¥çœ‹nginxçš„å®æ—¶æ—¥å¿—</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">docker-compose config  -q                        éªŒè¯ï¼ˆdocker-compose.ymlï¼‰æ–‡ä»¶é…ç½®ï¼Œå½“é…ç½®æ­£ç¡®æ—¶ï¼Œä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œå½“æ–‡ä»¶é…ç½®é”™è¯¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ </span><br><span class="line"></span><br><span class="line">docker-compose events --json nginx       ä»¥jsonçš„å½¢å¼è¾“å‡ºnginxçš„dockeræ—¥å¿—</span><br><span class="line"></span><br><span class="line">docker-compose pause nginx                 æš‚åœnignxå®¹å™¨</span><br><span class="line"></span><br><span class="line">docker-compose unpause nginx             æ¢å¤ningxå®¹å™¨</span><br><span class="line"></span><br><span class="line">docker-compose <span class="built_in">rm</span> nginx                       åˆ é™¤å®¹å™¨ï¼ˆåˆ é™¤å‰å¿…é¡»å…³é—­å®¹å™¨ï¼‰</span><br><span class="line"></span><br><span class="line">docker-compose stop nginx                    åœæ­¢nignxå®¹å™¨</span><br><span class="line"></span><br><span class="line">docker-compose start nginx                    å¯åŠ¨nignxå®¹å™¨</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2021/03/03/2021-03-03-docker_network/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2021/03/03/2021-03-03-docker_network/" class="post-title-link" itemprop="url">Docker network</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-03 13:30:00" itemprop="dateCreated datePublished" datetime="2021-03-03T13:30:00+08:00">2021-03-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="ç¯å¢ƒè¯´æ˜"><a href="#ç¯å¢ƒè¯´æ˜" class="headerlink" title="ç¯å¢ƒè¯´æ˜"></a>ç¯å¢ƒè¯´æ˜</h2><p>ä¸¤å°vagrant åˆ›å»ºçš„ docker è™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºé…ç½®ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">boxes = [</span><br><span class="line">    &#123;</span><br><span class="line">        :name =&gt; <span class="string">&quot;docker-node1&quot;</span>,</span><br><span class="line">        :eth1 =&gt; <span class="string">&quot;192.168.205.10&quot;</span>,</span><br><span class="line">        :mem =&gt; <span class="string">&quot;1024&quot;</span>,</span><br><span class="line">        :cpu =&gt; <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        :name =&gt; <span class="string">&quot;docker-node2&quot;</span>,</span><br><span class="line">        :eth1 =&gt; <span class="string">&quot;192.168.205.11&quot;</span>,</span><br><span class="line">        :mem =&gt; <span class="string">&quot;1024&quot;</span>,</span><br><span class="line">        :cpu =&gt; <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¸¤ä¸ª docker å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name <span class="built_in">test</span> busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br><span class="line">sudo docker run -d --name test1 busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/8.png" alt="avatar"></p><p>æ­¤æ—¶å‘ç°da678d729936çš„ipåœ°å€ä¸º172.17.0.3ï¼Œcf393747710eçš„ipåœ°å€ä¸º172.17.0.2</p><p>æ‰§è¡Œ<code>docker exec da678d729936 ping 172.17.0.2</code>è¯•è¯•å¯ä¸å¯ä»¥pingé€šcf393747710eçš„ip</p><p><img src="/img/in-post/2019-03-03/9.png" alt="avatar"></p><p>å‘ç°å¯ä»¥pingé€šï¼Œè¯æ˜dockerä¸¤ä¸ªcontainerä¹‹é—´çš„ip namespaceæ˜¯éš”ç¦»å¼€çš„ï¼Œä½†æ˜¯ä¸¤ä¸ªipä¹‹é—´æ˜¯å¯ä»¥pingé€šçš„ï¼Œé‚£ä¹ˆå…·ä½“åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å®éªŒæ¨¡æ‹Ÿæ¥ç†è§£ä¸€ä¸‹</p><h2 id="network-namespace"><a href="#network-namespace" class="headerlink" title="network namespace"></a>network namespace</h2><h3 id="åˆ›å»ºnet-namespace"><a href="#åˆ›å»ºnet-namespace" class="headerlink" title="åˆ›å»ºnet namespace"></a>åˆ›å»ºnet namespace</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ip netns add &lt;name&gt;        //  æ·»åŠ ä¸€ä¸ªnamespace</span><br><span class="line">sudo ip netns list</span><br><span class="line">sudo ip netns <span class="built_in">exec</span> <span class="built_in">test</span> ip a    //  æŸ¥çœ‹<span class="built_in">test</span> ip info</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸¤ä¸ªnamespace</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ip netns add <span class="built_in">test</span></span><br><span class="line">sudo ip netns add test1</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>sudo ip netns exec test ip link</code> æŸ¥çœ‹ipä¿¡æ¯<br><img src="/img/in-post/2019-03-03/2.png" alt="avatar"></p><p>æ¥å£å¯åŠ¨å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip netns <span class="built_in">exec</span> <span class="built_in">test</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev lo up</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶loç½‘å¡æ˜¯downçŠ¶æ€</p><p>æ‰§è¡Œ<code>sudo ip netns exec test ip link set dev lo up</code> å°†lo å¼€å¯<br><img src="/img/in-post/2019-03-03/3.png" alt="avatar"></p><p>å‡ºç°unknownåŸå› æ˜¯å› ä¸ºloæ˜¯å•ä¸ªæ¥å£ï¼Œåªæœ‰åšlinkåçš„æˆå¯¹æ¥å£å¯ä»¥up</p><h3 id="link-namespace"><a href="#link-namespace" class="headerlink" title="link namespace"></a>link namespace</h3><p>æ·»åŠ ä¸€å¯¹vethæ¥å£ï¼Œæ‰§è¡Œ<code>sudo ip link add veth-test type veth peer name veth-test1</code></p><p><img src="/img/in-post/2019-03-03/4.png" alt="avatar"></p><p>æ·»åŠ  veth-test åˆ° test namespace ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip <span class="built_in">link</span> <span class="built_in">set</span> veth-test netns <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>åˆ†åˆ«æŸ¥çœ‹æœ¬åœ°å’Œtest ip link ä¿¡æ¯</p><p><img src="/img/in-post/2019-03-03/5.png" alt="avatar"></p><p>å‘ç°æœ¬åœ°çš„veth-testæ¥å£è¢«æ·»åŠ åˆ°äº†testä¸­ï¼ŒåŒç†ï¼Œæ·»åŠ test1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip <span class="built_in">link</span> <span class="built_in">set</span> veth-test1 netns test1</span><br></pre></td></tr></table></figure><h3 id="ip-link"><a href="#ip-link" class="headerlink" title="ip link"></a>ip link</h3><p>æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ip netns <span class="built_in">exec</span> <span class="built_in">test</span> ip addr add 192.168.1.1/24 dev veth-test</span><br><span class="line">sudo ip netns <span class="built_in">exec</span> test1 ip addr add 192.168.1.2/24 dev veth-test1</span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨æ¥å£ï¼Œå‚ç…§ä¸Šé¢å¯åŠ¨loæ¥å£çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ip netns <span class="built_in">exec</span> <span class="built_in">test</span> ip <span class="built_in">link</span> <span class="built_in">set</span> dev veth-test up</span><br><span class="line">sudo ip netns <span class="built_in">exec</span> test1 ip <span class="built_in">link</span> <span class="built_in">set</span> dev veth-test1 up</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹testå’Œtest1 ip çŠ¶æ€<br><img src="/img/in-post/2019-03-03/6.png" alt="avatar"></p><p>å‘ç°ä¸¤ä¸ªæ¥å£çŠ¶æ€éƒ½æ˜¯state upï¼Œå¹¶ä¸”testå’Œtest1å‡å·²åˆ†é…192.168.1.1å’Œ192.168.1.2è¡¨ç¤ºæ¥å£å·²ç»å¯åŠ¨æˆåŠŸ,æµ‹è¯•ç›¸äº’pingä¸€ä¸‹</p><p><img src="/img/in-post/2019-03-03/7.png" alt="avatar"></p><h2 id="docker-network"><a href="#docker-network" class="headerlink" title="docker network"></a>docker network</h2><h3 id="bridge"><a href="#bridge" class="headerlink" title="bridge"></a>bridge</h3><p>æŠŠä¹‹å‰docker container ä¸­çš„ä¸¤ä¸ªå®¹å™¨stopå’Œrmæ‰ï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸ªtestå®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name <span class="built_in">test</span> busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// åˆ—ä¸¾å‡ºdockerçš„ç½‘ç»œ</span><br><span class="line">sudo docker network <span class="built_in">ls</span></span><br><span class="line">// æŸ¥çœ‹æŸä¸ªdocker network <span class="built_in">id</span> çš„å…·ä½“ä¿¡æ¯</span><br><span class="line">sudo docker network inspect &lt;networkid&gt;</span><br></pre></td></tr></table></figure><p>eg: æŸ¥çœ‹bridgeç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 labs]$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">8378c2ff8198        busybox             <span class="string">&quot;/bin/sh -c &#x27;while tâ€¦&quot;</span>   3 seconds ago       Up 3 seconds                            <span class="built_in">test</span></span><br><span class="line">[vagrant@docker-node1 labs]$ docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">1fb7b167deb2        bridge              bridge              <span class="built_in">local</span></span><br><span class="line">2d13173ae2bf        host                host                <span class="built_in">local</span></span><br><span class="line">6d2c375cd6cd        none                null                <span class="built_in">local</span></span><br><span class="line">[vagrant@docker-node1 labs]$ docker network inspect 1fb7b167deb2</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;1fb7b167deb233148d61b85c03bb68d9b8e3cbb124b60deb7be8acf88abdac21&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2019-03-03T02:04:36.334606846Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;172.17.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;8378c2ff8198bbac6647463286408de11a7814c7882e99232404ecab0e1517ad&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;f976820b8133d11cd37602ece5f762106aba2f3735420272ad0ed3bd8b1dc58a&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;172.17.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.default_bridge&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_icc&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.enable_ip_masquerade&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.host_binding_ipv4&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.bridge.name&quot;</span>: <span class="string">&quot;docker0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;com.docker.network.driver.mtu&quot;</span>: <span class="string">&quot;1500&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[vagrant@docker-node1 labs]$</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/10.png" alt="avatar"></p><p>é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡ºæœ¬åœ°çš„ vethd347bdc@if11 å’Œ å®¹å™¨å†…çš„ eth0@if12 æ˜¯ä¸€å¯¹æ¥å£<br>è¿™ä¸€å¯¹veth peer è¿æ¥åˆ°äº†docker0çš„ç½‘ç»œä¸Šé¢ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ¼”ç¤ºéªŒè¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install bridge-utils</span><br></pre></td></tr></table></figure><p>brctlå‘½ä»¤è¯´æ˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 labs]$ brctl</span><br><span class="line">Usage: brctl [commands]</span><br><span class="line">commands:</span><br><span class="line">	addbr     	&lt;bridge&gt;		add bridge</span><br><span class="line">	delbr     	&lt;bridge&gt;		delete bridge</span><br><span class="line">	addif     	&lt;bridge&gt; &lt;device&gt;	add interface to bridge</span><br><span class="line">	delif     	&lt;bridge&gt; &lt;device&gt;	delete interface from bridge</span><br><span class="line">	hairpin   	&lt;bridge&gt; &lt;port&gt; &#123;on|off&#125;	turn hairpin on/off</span><br><span class="line">	setageing 	&lt;bridge&gt; &lt;time&gt;		<span class="built_in">set</span> ageing time</span><br><span class="line">	setbridgeprio	&lt;bridge&gt; &lt;prio&gt;		<span class="built_in">set</span> bridge priority</span><br><span class="line">	setfd     	&lt;bridge&gt; &lt;time&gt;		<span class="built_in">set</span> bridge forward delay</span><br><span class="line">	sethello  	&lt;bridge&gt; &lt;time&gt;		<span class="built_in">set</span> hello time</span><br><span class="line">	setmaxage 	&lt;bridge&gt; &lt;time&gt;		<span class="built_in">set</span> max message age</span><br><span class="line">	setpathcost	&lt;bridge&gt; &lt;port&gt; &lt;cost&gt;	<span class="built_in">set</span> path cost</span><br><span class="line">	setportprio	&lt;bridge&gt; &lt;port&gt; &lt;prio&gt;	<span class="built_in">set</span> port priority</span><br><span class="line">	show      	[ &lt;bridge&gt; ]		show a list of bridges</span><br><span class="line">	showmacs  	&lt;bridge&gt;		show a list of mac addrs</span><br><span class="line">	showstp   	&lt;bridge&gt;		show bridge stp info</span><br><span class="line">	stp       	&lt;bridge&gt; &#123;on|off&#125;	turn stp on/off</span><br><span class="line">[vagrant@docker-node1 labs]$</span><br></pre></td></tr></table></figure><p>å¯åŠ¨test2å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name test1 busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>brctl show</code>å‘½ä»¤å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 labs]$ brctl show</span><br><span class="line">bridge name	bridge <span class="built_in">id</span>		STP enabled	interfaces</span><br><span class="line">docker0		8000.02425db75bb1	no		veth4de57f6</span><br><span class="line">							            vethd347bdc</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°docker0å’Œä¸¤ä¸ªveth peeræ¥å£çš„å…³ç³»</p><h3 id="host-å’Œ-none"><a href="#host-å’Œ-none" class="headerlink" title="host å’Œ none"></a>host å’Œ none</h3><h4 id="none"><a href="#none" class="headerlink" title="none"></a>none</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name test4 --network none busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/25.png" alt="avatar"></p><p>è¿™ç§æ–¹å¼åˆ›å»ºçš„å®¹å™¨æ²¡æœ‰ipåœ°å€ï¼Œåªèƒ½é€šè¿‡execçš„æ–¹å¼è¿›å…¥</p><p><img src="/img/in-post/2019-03-03/26.png" alt="avatar"></p><h4 id="host"><a href="#host" class="headerlink" title="host"></a>host</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name test5 --network host busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/27.png" alt="avatar"></p><p>è¿›å…¥test5å®¹å™¨æŸ¥çœ‹ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 ~]$ docker <span class="built_in">exec</span> test5 ip a</span><br><span class="line">...</span><br><span class="line">37: veth9cb9ecd@if36: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue master docker0</span><br><span class="line">    <span class="built_in">link</span>/ether ce:61:3e:72:57:f9 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet6 fe80::cc61:3eff:fe72:57f9/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">...</span><br><span class="line">[vagrant@docker-node1 ~]$  ip a</span><br><span class="line">...</span><br><span class="line">37: veth9cb9ecd@if36: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP</span><br><span class="line">    <span class="built_in">link</span>/ether ce:61:3e:72:57:f9 brd ff:ff:ff:ff:ff:ff link-netnsid 4</span><br><span class="line">    inet6 fe80::cc61:3eff:fe72:57f9/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°è¿™ç§æ–¹å¼çš„docker container å…±äº«äº†ä¸»æœºé‡Œé¢çš„ip namespace</p><h2 id="å¤šæœºå™¨é€šä¿¡"><a href="#å¤šæœºå™¨é€šä¿¡" class="headerlink" title="å¤šæœºå™¨é€šä¿¡"></a>å¤šæœºå™¨é€šä¿¡</h2><p><img src="/img/in-post/2019-03-03/28.png" alt="avatar"></p><h3 id="Mutil-host-networking-with-etcd"><a href="#Mutil-host-networking-with-etcd" class="headerlink" title="Mutil-host networking with etcd"></a>Mutil-host networking with etcd</h3><h4 id="setup-etcd-cluster"><a href="#setup-etcd-cluster" class="headerlink" title="setup etcd cluster"></a>setup etcd cluster</h4><p>åœ¨docker-node1ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vagrant@docker-node1:~$ wget https://github.com/coreos/etcd/releases/download/v3.0.12/etcd-v3.0.12-linux-amd64.tar.gz</span><br><span class="line">vagrant@docker-node1:~$ tar zxvf etcd-v3.0.12-linux-amd64.tar.gz</span><br><span class="line">vagrant@docker-node1:~$ cd etcd-v3.0.12-linux-amd64</span><br><span class="line">vagrant@docker-node1:~$ nohup ./etcd --name docker-node1 --initial-advertise-peer-urls http://192.168.205.10:2380 \</span><br><span class="line">--listen-peer-urls http://192.168.205.10:2380 \</span><br><span class="line">--listen-client-urls http://192.168.205.10:2379,http://127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls http://192.168.205.10:2379 \</span><br><span class="line">--initial-cluster-token etcd-cluster \</span><br><span class="line">--initial-cluster docker-node1=http://192.168.205.10:2380,docker-node2=http://192.168.205.11:2380 \</span><br><span class="line">--initial-cluster-state new&amp;</span><br></pre></td></tr></table></figure><p>åœ¨docker-node2ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vagrant@docker-node2:~$ wget https://github.com/coreos/etcd/releases/download/v3.0.12/etcd-v3.0.12-linux-amd64.tar.gz</span><br><span class="line">vagrant@docker-node2:~$ tar zxvf etcd-v3.0.12-linux-amd64.tar.gz</span><br><span class="line">vagrant@docker-node2:~$ cd etcd-v3.0.12-linux-amd64/</span><br><span class="line">vagrant@docker-node2:~$ nohup ./etcd --name docker-node2 --initial-advertise-peer-urls http://192.168.205.11:2380 \</span><br><span class="line">--listen-peer-urls http://192.168.205.11:2380 \</span><br><span class="line">--listen-client-urls http://192.168.205.11:2379,http://127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls http://192.168.205.11:2379 \</span><br><span class="line">--initial-cluster-token etcd-cluster \</span><br><span class="line">--initial-cluster docker-node1=http://192.168.205.10:2380,docker-node2=http://192.168.205.11:2380 \</span><br><span class="line">--initial-cluster-state new&amp;</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥clusterçŠ¶æ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vagrant@docker-node2:~/etcd-v3.0.12-linux-amd64$ ./etcdctl cluster-health</span><br><span class="line">member 21eca106efe4caee is healthy: got healthy result from http://192.168.205.10:2379</span><br><span class="line">member 8614974c83d1cc6d is healthy: got healthy result from http://192.168.205.11:2379</span><br><span class="line">cluster is healthy</span><br></pre></td></tr></table></figure><h4 id="é‡å¯dockeræœåŠ¡"><a href="#é‡å¯dockeræœåŠ¡" class="headerlink" title="é‡å¯dockeræœåŠ¡"></a>é‡å¯dockeræœåŠ¡</h4><p>åœ¨docker-node1ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker stop</span><br><span class="line">$ sudo /usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --cluster-store=etcd://192.168.205.10:2379 --cluster-advertise=192.168.205.10:2375&amp;</span><br></pre></td></tr></table></figure><p>åœ¨docker-node2ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo service docker stop</span><br><span class="line">$ sudo /usr/bin/dockerd -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --cluster-store=etcd://192.168.205.11:2379 --cluster-advertise=192.168.205.11:2375&amp;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºoverlay-network"><a href="#åˆ›å»ºoverlay-network" class="headerlink" title="åˆ›å»ºoverlay network"></a>åˆ›å»ºoverlay network</h4><p>åœ¨docker-node1ä¸Šåˆ›å»ºä¸€ä¸ªdemoçš„overlay network</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 etcd-v3.0.12-linux-amd64]$ sudo docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">22c070951371        bridge              bridge              local</span><br><span class="line">2d13173ae2bf        host                host                local</span><br><span class="line">c144a2167891        my-bridge           bridge              local</span><br><span class="line">6d2c375cd6cd        none                null                local</span><br><span class="line">[vagrant@docker-node1 etcd-v3.0.12-linux-amd64]$ sudo docker network create -d overlay demo</span><br><span class="line">6f58ba8913c3e0df5ac9086f79e87cc62e57ac723d26dcb05edb7635f19103c8</span><br><span class="line">[vagrant@docker-node1 etcd-v3.0.12-linux-amd64]$ sudo docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">22c070951371        bridge              bridge              local</span><br><span class="line">6f58ba8913c3        demo                overlay             global</span><br><span class="line">2d13173ae2bf        host                host                local</span><br><span class="line">c144a2167891        my-bridge           bridge              local</span><br><span class="line">6d2c375cd6cd        none                null                local</span><br><span class="line">[vagrant@docker-node1 etcd-v3.0.12-linux-amd64]$ sudo docker network inspect demo</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;demo&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;6f58ba8913c3e0df5ac9086f79e87cc62e57ac723d26dcb05edb7635f19103c8&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2019-03-03T13:03:20.535696601Z&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;global&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;10.0.0.0/24&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;10.0.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨node2ä¸Šï¼Œè¿™ä¸ªdemoçš„overlay networkä¼šè¢«åŒæ­¥åˆ›å»º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vagrant@docker-node2:~$ sudo docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">c9947d4c3669        bridge              bridge              local</span><br><span class="line">3d430f3338a2        demo                overlay             global</span><br><span class="line">fa5168034de1        host                host                local</span><br><span class="line">c2ca34abec2a        none                null                local</span><br></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥çœ‹etcdçš„key-value, æˆ‘ä»¬è·å–åˆ°ï¼Œè¿™ä¸ªdemoçš„networkæ˜¯é€šè¿‡etcdä»node1åŒæ­¥åˆ°node2çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node2 etcd-v3.0.12-linux-amd64]$ ./etcdctl ls /docker</span><br><span class="line">/docker/network</span><br><span class="line">/docker/nodes</span><br><span class="line">[vagrant@docker-node2 etcd-v3.0.12-linux-amd64]$ ./etcdctl ls /docker/nodes</span><br><span class="line">/docker/nodes/192.168.205.10:2375</span><br><span class="line">/docker/nodes/192.168.205.11:2375</span><br><span class="line">[vagrant@docker-node2 etcd-v3.0.12-linux-amd64]$ ./etcdctl ls /docker/network/v1.0/network</span><br><span class="line">/docker/network/v1.0/network/6f58ba8913c3e0df5ac9086f79e87cc62e57ac723d26dcb05edb7635f19103c8</span><br><span class="line">[vagrant@docker-node2 etcd-v3.0.12-linux-amd64]$ ./etcdctl get /docker/network/v1.0/network/6f58ba8913c3e0df5ac9086f79e87cc62e57ac723d26dcb05edb7635f19103c8</span><br><span class="line">&#123;&quot;addrSpace&quot;:&quot;GlobalDefault&quot;,&quot;attachable&quot;:false,&quot;configFrom&quot;:&quot;&quot;,&quot;configOnly&quot;:false,&quot;created&quot;:&quot;2019-03-03T13:03:20.535696601Z&quot;,&quot;enableIPv6&quot;:false,&quot;generic&quot;:&#123;&quot;com.docker.network.enable_ipv6&quot;:false,&quot;com.docker.network.generic&quot;:&#123;&#125;&#125;,&quot;id&quot;:&quot;6f58ba8913c3e0df5ac9086f79e87cc62e57ac723d26dcb05edb7635f19103c8&quot;,&quot;inDelete&quot;:false,&quot;ingress&quot;:false,&quot;internal&quot;:false,&quot;ipamOptions&quot;:&#123;&#125;,&quot;ipamType&quot;:&quot;default&quot;,&quot;ipamV4Config&quot;:&quot;[&#123;\&quot;PreferredPool\&quot;:\&quot;\&quot;,\&quot;SubPool\&quot;:\&quot;\&quot;,\&quot;Gateway\&quot;:\&quot;\&quot;,\&quot;AuxAddresses\&quot;:null&#125;]&quot;,&quot;ipamV4Info&quot;:&quot;[&#123;\&quot;IPAMData\&quot;:\&quot;&#123;\\\&quot;AddressSpace\\\&quot;:\\\&quot;GlobalDefault\\\&quot;,\\\&quot;Gateway\\\&quot;:\\\&quot;10.0.0.1/24\\\&quot;,\\\&quot;Pool\\\&quot;:\\\&quot;10.0.0.0/24\\\&quot;&#125;\&quot;,\&quot;PoolID\&quot;:\&quot;GlobalDefault/10.0.0.0/24\&quot;&#125;]&quot;,&quot;labels&quot;:&#123;&#125;,&quot;loadBalancerIP&quot;:&quot;&quot;,&quot;loadBalancerMode&quot;:&quot;NAT&quot;,&quot;name&quot;:&quot;demo&quot;,&quot;networkType&quot;:&quot;overlay&quot;,&quot;persist&quot;:true,&quot;postIPv6&quot;:false,&quot;scope&quot;:&quot;global&quot;&#125;</span><br><span class="line">[vagrant@docker-node2 etcd-v3.0.12-linux-amd64]$</span><br></pre></td></tr></table></figure><p>åœ¨node1ä¸­æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name test1 --net demo busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p>åœ¨node2ä¸­æ‰§è¡Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -d --name test2 --net demo busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p>åˆ†åˆ«æŸ¥çœ‹test1,test2 ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node1 etcd-v3.0.12-linux-amd64]$ docker <span class="built_in">exec</span> test1 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">19: eth0@if20: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1450 qdisc noqueue</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:0a:00:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.2/24 brd 10.0.0.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">21: eth1@if22: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:13:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.19.0.2/16 brd 172.19.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> test2 ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue qlen 1</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: eth0@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1450 qdisc noqueue</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:0a:00:00:03 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.3/24 brd 10.0.0.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">10: eth1@if11: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦èƒ½pingé€š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[vagrant@docker-node2 etcd-v3.0.12-linux-amd64]$ docker <span class="built_in">exec</span> test2 ping 10.0.0.2</span><br><span class="line">PING 10.0.0.2 (10.0.0.2): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.2: <span class="built_in">seq</span>=0 ttl=64 time=9.354 ms</span><br><span class="line">64 bytes from 10.0.0.2: <span class="built_in">seq</span>=1 ttl=64 time=0.789 ms</span><br><span class="line">64 bytes from 10.0.0.2: <span class="built_in">seq</span>=2 ttl=64 time=1.062 ms</span><br><span class="line">^C</span><br><span class="line">[vagrant@docker-node2 etcd-v3.0.12-linux-amd64]$ docker <span class="built_in">exec</span> test2 ping test1</span><br><span class="line">PING test1 (10.0.0.2): 56 data bytes</span><br><span class="line">64 bytes from 10.0.0.2: <span class="built_in">seq</span>=0 ttl=64 time=0.724 ms</span><br><span class="line">64 bytes from 10.0.0.2: <span class="built_in">seq</span>=1 ttl=64 time=0.590 ms</span><br><span class="line">Ã§64 bytes from 10.0.0.2: <span class="built_in">seq</span>=2 ttl=64 time=0.789 ms</span><br><span class="line">64 bytes from 10.0.0.2: <span class="built_in">seq</span>=3 ttl=64 time=0.651 ms</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2021/03/03/2021-03-03-docker-port/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2021/03/03/2021-03-03-docker-port/" class="post-title-link" itemprop="url">Docker network port</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-03 11:30:00" itemprop="dateCreated datePublished" datetime="2021-03-03T11:30:00+08:00">2021-03-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="ç«¯å£æ˜ å°„"><a href="#ç«¯å£æ˜ å°„" class="headerlink" title="ç«¯å£æ˜ å°„"></a>ç«¯å£æ˜ å°„</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name web -d nginx</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/19.png" alt="avatar"></p><p>ç”±ä¸Šå›¾å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºå†…éƒ¨è®¿é—®containerçš„ipçš„æ–¹å¼å¯ä»¥è®¿é—®åˆ°nginxæ¬¢è¿é¡µï¼Œä½†æ˜¯è®¿é—®æœ¬åœ°åœ°å€æ˜ å°„ä¸åˆ°,<br>å¯ä»¥é€šè¿‡ç«¯å£æ˜ å°„æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p>åˆ é™¤åˆšæ‰çš„nginx container,é‡æ–°å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker stop web</span><br><span class="line">docker <span class="built_in">rm</span> web</span><br><span class="line">docker run --name web -d -p 80:80 nginx</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/20.png" alt="avatar"></p><p>æ˜ å°„æˆåŠŸ</p><p>æˆ‘çš„vagrant ip æ˜ å°„é…ç½®<br><img src="/img/in-post/2019-03-03/21.png" alt="avatar"><br><img src="/img/in-post/2019-03-03/22.png" alt="avatar"></p><p>æ˜ å°„æµç¨‹</p><p><img src="/img/in-post/2019-03-03/24.png" alt="avatar"></p><p>å›¾ä¸­çš„192.168.205.10:80ä¸ºæˆ‘æœ¬æœºçš„ipç§æœ‰åœ°å€ï¼Œå¤–ç½‘ä¸èƒ½è®¿é—®ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªäº‘ä¸»æœºä¸Šåˆ›å»ºçš„webæœåŠ¡ï¼Œäº‘ä¸»æœºå°±å¯ä»¥åˆ†é…ä¸€ä¸ªpublicçš„ipå°±å¯ä»¥ä½œä¸ºå¤–ç½‘çš„å‡ºå£ipæ¥æä¾›æœåŠ¡</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://enpsl.github.io/2021/03/03/2021-03-03-docker-link/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="enpsl"><meta itemprop="description" content="my blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å½­è¯—äº®çš„åšå®¢"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/2021/03/03/2021-03-03-docker-link/" class="post-title-link" itemprop="url">Docker network link</a></h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-03 10:30:00" itemprop="dateCreated datePublished" datetime="2021-03-03T10:30:00+08:00">2021-03-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-01-19 15:31:17" itemprop="dateModified" datetime="2023-01-19T15:31:17+08:00">2023-01-19</time></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="docker-link"><a href="#docker-link" class="headerlink" title="docker link"></a>docker link</h1><h2 id="docker-link-1"><a href="#docker-link-1" class="headerlink" title="docker link"></a>docker link</h2><p>ç”±äºdocker container ä¹‹ä¸­çš„ ipåœ¨ä¸ºåˆ›å»ºä¹‹å‰æ˜¯æœªçŸ¥çš„ï¼Œä¸åˆ©äºæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„é…ç½®è¿æ¥ï¼Œæ‰€ä»¥docker æä¾›äº†ä¸€ç§åŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<br>å¯ä»¥é€šè¿‡ docker name ä¹‹é—´çš„linkæ¥è§£å†³</p><p><img src="/img/in-post/2019-03-03/11.png" alt="avatar"></p><p>åˆ›å»ºtest2å¹¶linkåˆ°test1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name test2 --<span class="built_in">link</span> test1 busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p>è¿›å…¥åˆ°test2å®¹å™¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it test2 /bin/sh</span><br><span class="line">ping test1</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/12.png" alt="avatar"></p><p>è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ï¼š<br>å‡å¦‚test1æœ‰ä¸€ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨test2å®¹å™¨ä¸­é€šè¿‡<code>mysql -u &lt;name&gt; -P &lt;port&gt; -h test1</code>æ¥è®¿é—®äº†</p><blockquote><p>ç”±äºæ˜¯test2 å»link test1 æ‰€ä»¥ï¼Œåœ¨test1å®¹å™¨ä¸­ï¼Œping test2æ˜¯ä¸å¯ç”¨çš„</p></blockquote><h2 id="network-åˆ›å»º"><a href="#network-åˆ›å»º" class="headerlink" title="network åˆ›å»º"></a>network åˆ›å»º</h2><p>åˆ é™¤æ‰test2å®¹å™¨å¹¶é‡æ–°åˆ›å»ºtest2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name test2 busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºbridge"><a href="#åˆ›å»ºbridge" class="headerlink" title="åˆ›å»ºbridge"></a>åˆ›å»ºbridge</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network create -d bridge my-bridge</span><br><span class="line">docker network <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/13.png" alt="avatar"></p><p>åˆ›å»ºtest3å¹¶æŒ‡å®šnetworkåˆ°my-bridge</p><blockquote><p>å¦‚æœä¸æŒ‡å®šnetworké»˜è®¤è¿æ¥æ˜¯docker0</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name test3 --network my-bridge busybox /bin/sh -c <span class="string">&quot;while true; do sleep 3600; done&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/14.png" alt="avatar"></p><p>æŸ¥çœ‹test3 container networkä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect &lt;my-bridge <span class="built_in">id</span>&gt;</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/15.png" alt="avatar"></p><h3 id="bridgeè¿æ¥"><a href="#bridgeè¿æ¥" class="headerlink" title="bridgeè¿æ¥"></a>bridgeè¿æ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect my-bridge test2</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect bridge</span><br><span class="line">docker network inspect my-bridge</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°bridgeå’Œmy-bridgeçš„containerä¸­éƒ½åŒ…å«äº†test2</p><p>è¿›å…¥åˆ°test2å®¹å™¨ä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it test2 /bin/sh</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/16.png" alt="avatar"></p><p>å¯ä»¥å‘ç°åœ¨test2å®¹å™¨ä¸­å¯ä»¥pingé€štest3ä½†æ˜¯ä¸èƒ½ping test1, å®é™…ä¸Šdockeråœ¨ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„bridgeä¸­åšäº†ä¸€å±‚linkï¼Œæ‰€ä»¥test2å’Œtest3å®¹å™¨å¯ä»¥ç›¸äº’ping é€šå¯¹æ–¹</p><p>æŠŠtest1ä¹ŸåŠ å…¥åˆ°my-bridgeä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect my-bridge test1</span><br></pre></td></tr></table></figure><p><img src="/img/in-post/2019-03-03/17.png" alt="avatar"></p><p>æ­¤æ—¶test1ä¹Ÿå¯ä»¥pingé€šäº†</p></div><footer class="post-footer"><div class="post-eof"></div></footer></article><nav class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a> <a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a></nav></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview"> ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">enpsl</p><div class="site-description" itemprop="description">my blog</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">31</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">enpsl</span></div><div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script></body></html>